"use strict";var accountApp=angular.module("accountApp",["ngRoute","ngAnimate","ngTouch","ngRetina","angular-md5","templates","accountApp.services","accountApp.directives","accountApp.controllers","accountApp.animations"]),accountAppControllers=angular.module("accountApp.controllers",[]),accountAppDirectives=angular.module("accountApp.directives",[]),accountAppServices=angular.module("accountApp.services",[]),accountAppAnimations=angular.module("accountApp.animations",[]);accountApp.config(["$compileProvider",function(e){}]).config(["$httpProvider",function(e){e.interceptors.push("Interceptor")}]).config(["$routeProvider",function(e){var t={delay:["$q","$timeout","Loading",function(e,t,o){}],wechatResolve:["Request","$location","$rootScope","$window","Config","$q","Utils",function(e,t,o,n,i,a,r){if(!o.isWechat||"miniprogram"===window.__wxjs_environment)return{};var c=a.defer();return o.openid?c.resolve():e.getWechatOpenId().then(function(e){o.openid=e.cookie,o.isWechatLogin=e.is_login,c.resolve(e)},function(){c.resolve(),n.location.replace(i.wechatMixinUrl+r.getUrlUnicode())}),c.promise}],wechatCheckResolve:["Request","$location","$rootScope","$window","Config","$q",function(e,t,o,n,i,a){if(!o.isWechat)return{};var r=a.defer();return e.checkWechatBind().then(function(e){e.errno==i.errnoMap.OK&&e.data&&(o.wechatCheckStatus=!!e.data.bind),r.resolve()},function(){r.resolve()}),r.promise}],userInfo:["$location","Request","Config",function(e,t,o){return t.getSettings().then(function(e){return e})}],userAccount:["Content",function(e){return e.takeUserAccount().then(function(e){return e})}],deviceData:["Content",function(e){return e.takeDeviceData().then(function(e){return e})}]};e.when("/register",{templateUrl:"partials/register.html",controller:"RegisterCtrl",title:"用户注册",pageClass:"v2 register",resolve:{wechatParams:t.wechatResolve}}),e.when("/register/embed",{templateUrl:"partials/register.html",controller:"RegisterCtrl",title:"用户注册"}),e.when("/register/embed/bbs",{templateUrl:"partials/registerBbs.html",controller:"RegisterCtrl",title:"用户注册"}),e.when("/register-guest/embed",{templateUrl:"partials/registerGuest.html",controller:"RegisterGuestCtrl",title:"验证手机"}),e.when("/login",{redirectTo:"/v2/login"}),e.when("/login/embed",{templateUrl:"partials/login.html",controller:"LoginCtrl",title:"用户登录"}),e.when("/login/embed/bbs",{templateUrl:"partials/loginBbs.html",controller:"LoginCtrl",pageClass:"login",title:"用户登录"}),e.when("/login/embed/cloud",{templateUrl:"partials/login.html",controller:"LoginCtrl",pageClass:"login",title:"用户登录"}),e.when("/login-guest/embed",{templateUrl:"partials/loginGuest.html",controller:"LoginGuestCtrl",title:"登录账户"}),e.when("/login/:action",{templateUrl:"partials/login.html",controller:"LoginCtrl",title:"用户登录"}),e.when("/logout",{template:"",controller:"LogoutCtrl",title:"用户退出",resolve:{wechatParams:t.wechatCheckResolve}}),e.when("/logout/embed",{template:"",controller:"LogoutCtrl",title:"用户退出"}),e.when("/modifyAvatar",{templateUrl:"partials/modifyAvatar.html",controller:"ModifyAvatarCtrl",title:"设置头像",pageClass:"v2",userRequired:!0}),e.when("/modifyAvatar/embed",{templateUrl:"partials/modifyAvatar.html",controller:"ModifyAvatarCtrl",title:"设置头像",userRequired:!0}),e.when("/modifyName",{templateUrl:"partials/modifyName.html",controller:"ModifyNameCtrl",title:"设置昵称",pageClass:"v2 modify-name",userRequired:!0}),e.when("/modifyPassword",{templateUrl:"partials/modifyPassword.html",controller:"ModifyPasswordCtrl",title:"修改密码",pageClass:"v2",userRequired:!0}),e.when("/modifyMobile",{templateUrl:"partials/modifyMobile.html",controller:"ModifyMobileCtrl",title:"修改手机",pageClass:"v2 modify-mobile",userRequired:!0}),e.when("/modifyMail",{templateUrl:"partials/modifyMail.html",controller:"ModifyMailCtrl",title:"修改邮箱",pageClass:"v2",userRequired:!0,resolve:{userInfo:["Request",function(e){return e.getUserAuths()}]}}),e.when("/modifyQuestion",{templateUrl:"partials/modifyQuestion.html",controller:"ModifyQuestionCtrl",title:"设置安全问题",pageClass:"v2 modify-question",userRequired:!0,resolve:{questionData:["Request",function(e){return e.getQuestions().then(function(e){return e})}]}}),e.when("/forgotPassword",{templateUrl:"partials/forgotPassword.html",controller:"ForgotPasswordCtrl",pageClass:"v2 forgot-password",title:"忘记密码"}),e.when("/settings/embed",{templateUrl:"partials/settings.html",controller:"SettingsCtrl",title:"账户设置",resolve:{settings:["Request",function(e){return e.getSettings()}]}}),e.when("/auth/:channelID",{templateUrl:"partials/auth.html",controller:"AuthCtrl",title:"安全验证",pageClass:"v2 auth-page",userRequired:!0,resolve:{userAuths:["Request",function(e){return e.getUserAuths()}]}}),e.when("/result/:channelID",{templateUrl:"partials/result.html",title:"修改成功",controller:"ResultCtrl",pageClass:"v2"}),e.when("/v2/login",{templateUrl:"partials/loginV2.html",controller:"LoginV2Ctrl",title:"用户登录",pageClass:"v2 login-v2",resolve:{wechatParams:t.wechatResolve,userInfo:t.userInfo}}),e.when("/v2/login/:action",{templateUrl:"partials/loginV2.html",controller:"LoginV2Ctrl",title:"用户登录",pageClass:"v2 login-v2",resolve:{wechatParams:t.wechatResolve,userInfo:t.userInfo}}),e.when("/bindAccount",{templateUrl:"partials/bindAccount.html",controller:"BindAccountCtrl",title:"绑定手机",pageClass:"v2 bind-account",userRequired:!0,resolve:{bindUserInfo:["Request",function(e){return e.getBindInfo()}]}}),e.when("/bindPassword",{templateUrl:"partials/bindPassword.html",controller:"BindPasswordCtrl",title:"设置密码",pageClass:"v2 bind-password",resolve:{bindUserInfo:["Request",function(e){return e.getBindInfo()}]}}),e.when("/warning/safety",{templateUrl:"partials/safety.html",controller:"SafetyCtrl",title:"账户安全提醒",pageClass:"v2 safety",resolve:{userInfo:t.userInfo}}),e.when("/personal/account",{templateUrl:"partials/personalAccount.html",controller:"PersonalAccountCtrl",title:"个人中心-账户设置",pageClass:"personal",resolve:{userInfo:t.userAccount}}),e.when("/personal/device",{templateUrl:"partials/personalDevice.html",controller:"PersonalDeviceCtrl",title:"个人中心-设备管理",pageClass:"personal",resolve:{userInfo:t.userInfo,deviceData:t.deviceData}}),e.otherwise({redirectTo:"/result/illegality"})}]),accountApp.run(["$rootScope","$route","$location","$timeout","$window","Loading","Utils","Config",function(e,t,o,n,i,a,r,c){e.$on("$routeChangeStart",function(t,n,r){var c=n.$$route?n.$$route.originalPath:null;c&&/settings/.test(c)?e.isSettings=!0:e.isSettings=!1,c&&/cloud/.test(c)?e.isEmbedCloud=!0:e.isEmbedCloud=!1;var s=o.search().origin;e.isEmbedNotes=/notes/i.test(s),e.isEmbedContacts=/contacts/i.test(s),e.isEmbedRadar=/radar/i.test(s),e.isEmbedBbs=/bbs\.smartisan\.com/.test(s),c&&/bbs/.test(c)?(e.isEmbedBbsTmp=!0,e.isEmbedBbs=!1):e.isEmbedBbsTmp=!1,(e.isEmbedBbsTmp||e.isEmbedBbs)&&(e.isRefresh=!0),c&&/modifyAvatar/.test(c)?e.isModifyAvatar=!0:e.isModifyAvatar=!1,/MicroMessenger/i.test(i.navigator.userAgent)?e.isWechat=!0:e.isWechat=!1,a.start()}),e.$on("$routeChangeSuccess",function(n,r,s){var l=r.$$route?r.$$route.originalPath:null;e.title=t.current.title,jQuery.support.leadingWhitespace||(i.document.title=t.current.title+" - 锤子科技");var u=e.isGuestLogin||!1;if(l&&/login\-guest/.test(l)?e.isGuestLogin=!0:e.isGuestLogin=!1,e.dialogChangeFlag=u!==e.isGuestLogin,a.done(),e.pageClass=t.current.pageClass?t.current.pageClass:"",$(".dialog").show(),i.parent!==i&&/personal/.test(l)){var d=o.search().origin||e.targetOrigin;c.legalOrigin.test(d)?e.targetOrigin=d:e.targetOrigin="https://cloud.smartisan.com",i.parent.postMessage("accountChangeRouter:"+l,e.targetOrigin)}})}]),accountAppServices.factory("Interceptor",["$q","$rootScope","$location","$window","Config",function(e,t,o,n,i){var a={request:function(t){return t||e.when(t)},requestError:function(t){return e.reject(t)},response:function(a){return a.data&&(0!=a.data.errno&&a.data.errno<=900?n.parent==n&&o.path("/result/system"):a.data.errno==i.errnoMap.UNAUTHORIZED&&(t.forgotPasswordMsg||/settings/.test(o.$$path)||/v2\/login/i.test(o.$$path)||(t.currentUid=void 0,t.currentToken=void 0,o.path("/result/unauthorized")))),a||e.when(a)},responseError:function(t){return e.reject(t)}};return a}]);var ConfigBaseProtocolHost=location.protocol+"//"+location.host;accountAppServices.constant("Config",{baseUrl:ConfigBaseProtocolHost+"/v2/",baseHost:location.host,baseProtocolHost:ConfigBaseProtocolHost,apiUrl:"https://api.smartisan.com/",openUrl:"https://open.smartisan.com/",officialURL:"http://www.smartisan.com/",cloudURL:"https://cloud.smartisan.com/",bindAccountURL:ConfigBaseProtocolHost+location.pathname+"#/bindAccount",hasBoundURL:ConfigBaseProtocolHost+"/#/result/bound",legalOrigin:/.+\.smartisan.com/,wechatMixinUrl:ConfigBaseProtocolHost+"/v2/wechat/redirect?custom=",reloadCaptchaUrl:ConfigBaseProtocolHost+"/v2/session/captcha/",headconfig:{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}},regExp:{isCnMobile:/^1[3|4|5|6|7|8|9]\d{9}$/,isMobile:/^\d{5,11}$/,isMobileGlobal:/^(\+\d{1,4}\s?)?\d{5,11}$/,isMail:/^[\w.%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}$/,isPassword:/^(?![a-zA-Z]+$)(?!\d+$)(?![\\\[\]\:\^\-~!@#$%&*()-+={}|;'",.\/<>?_]+$)[a-zA-Z_0-9\\\[\]\:\^\-~!@#$%&*()-+={}|;'",.\/<>?]{6,16}$/,isSafeUrl:/^(http|https)\:\/\/(?:[a-zA-Z0-9\-\.]+\.)?(smartisan.com\b|idaxiang.org\b|h-notes.com\b)((\/|#|\?)(:[a-zA-Z0-9]*)?\/?([a-zA-Z0-9\-\._\?\,\'\:\/\\\+&amp;%\$#\=~|])*)?$/},errnoMap:{OK:0,SYSTEM_MAINTENANCE:1,LOGIC_ERROR:2,FS_READ_ERROR:3,FS_WRITE_ERROR:4,DB_CONNECT_ERROR:5,DB_QUERY_ERROR:6,CACHE_CONNECT_ERROR:7,CACHE_QUERY_ERROR:8,PARAMETER_ERROR:1002,ILLEGAL_TICKET:1601,INVALID_TICKET:1602,ILLEGAL_UID:1101,ILLEGAL_PASSWORD:1102,ILLEGAL_AVATAR:1103,ILLEGAL_SECQUES:1104,ILLEGAL_SECANS:1105,INVALID_UID:1106,INVALID_PASSWORD:1107,INVALID_SECANS:1108,ALIAS_REQUIRED:1109,PASSWORD_REQUIRED:1110,ILLEGAL_ALIAS:1201,INVALID_ALIAS:1202,REGISTERED_ALIAS:1203,ILLEGAL_CELLPHONE:1204,INVALID_CELLPHONE:1205,REGISTERED_CELLPHONE:1206,ILLEGAL_EMAIL:1207,INVALID_EMAIL:1208,REGISTERED_EMAIL:1209,INVALID_NICKNAME:1210,UNREGISTERED_NICKNAME:1211,REGISTERED_NICKNAME:1212,ILLEGAL_NICKNAME:1213,ILLEGAL_VCODE:1301,INVALID_VCODE:1302,VCODE_TOO_OFTEN:1304,CAPTCHA_REQUIRED:1502,ILLEGAL_TOKEN:1401,INVALID_TOKEN:1402,UNAUTHORIZED:1701,REFRECH_VCODE:1303,FAILED_LOGIN_LIMIT:1501,OPENID_REGISTERED:2009,OPENID_OTHER_REGISTERED:2010,CELLPHONE_NO_REGISTER:2011,NO_AUTH:2012,FAILED_BY_DELETE_BANK_CARD:2501,FAILED_BY_DELETE_MOBILE:2502,INVALID_DEVICE_ID:2503,SUCCESS_FOR_DELETE_DEVICE:2504},mailUrl:{"163.com":"http://mail.163.com/","126.com":"http://mail.126.com/","139.com":"http://mail.10086.cn/","sina.com":"http://mail.sina.com.cn/","sina.cn":"http://mail.sina.com.cn/","qq.com":"https://mail.qq.com/","sohu.com":"http://mail.sohu.com/","gmail.com":"https://www.gmail.com/","yahoo.com":"https://login.yahoo.com/","21cn.com":"http://mail.21cn.com/","aliyun.com":"https://mail.aliyun.com/","outlook.com":"https://login.live.com/","yeah.net":"http://www.yeah.net/","sogou.com":"http://mail.sogou.com/","189.cn":"http://webmail9.189.cn/webmail/","cntv.cn":"http://mail.cntv.cn/","tianya.cn":"http://mail.tianya.cn/","hainan.net":"http://mail.tianya.cn/","hotmail.com":"https://login.live.com/"},cccList:[{code:"+355",name:"阿尔巴尼亚"},{code:"+93",name:"阿富汗"},{code:"+54",name:"阿根廷"},{code:"+971",name:"阿拉伯联合酋长国"},{code:"+297",name:"阿鲁巴"},{code:"+968",name:"阿曼"},{code:"+994",name:"阿塞拜疆"},{code:"+20",name:"埃及"},{code:"+251",name:"埃塞俄比亚"},{code:"+353",name:"爱尔兰"},{code:"+372",name:"爱沙尼亚"},{code:"+376",name:"安道尔共和国"},{code:"+244",name:"安哥拉"},{code:"+1264",name:"安圭拉岛"},{code:"+1268",name:"安提瓜和巴布达"},{code:"+61",name:"澳大利亚"},{code:"+43",name:"奥地利"},{code:"+1246",name:"巴巴多斯"},{code:"+675",name:"巴布亚新几内亚"},{code:"+1242",name:"巴哈马"},{code:"+595",name:"巴拉圭"},{code:"+973",name:"巴林"},{code:"+507",name:"巴拿马"},{code:"+55",name:"巴西"},{code:"+375",name:"白俄罗斯"},{code:"+1441",name:"百慕大群岛"},{code:"+359",name:"保加利亚"},{code:"+229",name:"贝宁"},{code:"+32",name:"比利时"},{code:"+354",name:"冰岛"},{code:"+1787",name:"波多黎各"},{code:"+387",name:"波黑"},{code:"+48",name:"波兰"},{code:"+591",name:"玻利维亚"},{code:"+501",name:"伯利兹"},{code:"+267",name:"博茨瓦纳"},{code:"+975",name:"不丹"},{code:"+226",name:"布基纳法索"},{code:"+257",name:"布隆迪"},{code:"+45",name:"丹麦"},{code:"+49",name:"德国"},{code:"+228",name:"多哥"},{code:"+1809",name:"多米尼加共和国"},{code:"+7",name:"俄罗斯"},{code:"+593",name:"厄瓜多尔"},{code:"+33",name:"法国"},{code:"+689",name:"法属玻利尼西亚"},{code:"+594",name:"法属圭亚那"},{code:"+63",name:"菲律宾"},{code:"+679",name:"斐济"},{code:"+358",name:"芬兰"},{code:"+238",name:"佛得角共和国"},{code:"+220",name:"冈比亚"},{code:"+57",name:"哥伦比亚"},{code:"+506",name:"哥斯达黎加"},{code:"+1473",name:"格林纳达"},{code:"+995",name:"格鲁吉亚"},{code:"+53",name:"古巴"},{code:"+1671",name:"关岛"},{code:"+592",name:"圭亚那"},{code:"+7",name:"哈萨克斯坦"},{code:"+509",name:"海地"},{code:"+82",name:"韩国"},{code:"+31",name:"荷兰"},{code:"+599",name:"荷属安的列斯"},{code:"+382",name:"黑山共和国"},{code:"+504",name:"洪都拉斯"},{code:"+253",name:"吉布提"},{code:"+996",name:"吉尔吉斯斯坦"},{code:"+224",name:"几内亚"},{code:"+1",name:"加拿大"},{code:"+233",name:"加纳"},{code:"+241",name:"加蓬"},{code:"+855",name:"柬埔寨"},{code:"+420",name:"捷克"},{code:"+263",name:"津巴布韦"},{code:"+237",name:"喀麦隆"},{code:"+974",name:"卡塔尔"},{code:"+1345",name:"开曼群岛"},{code:"+225",name:"科特迪瓦"},{code:"+965",name:"科威特"},{code:"+385",name:"克罗地亚"},{code:"+254",name:"肯尼亚"},{code:"+682",name:"库克群岛"},{code:"+371",name:"拉脱维亚"},{code:"+266",name:"莱索托"},{code:"+856",name:"老挝"},{code:"+961",name:"黎巴嫩"},{code:"+370",name:"立陶宛"},{code:"+231",name:"利比里亚"},{code:"+218",name:"利比亚"},{code:"+423",name:"列支敦士登"},{code:"+352",name:"卢森堡"},{code:"+250",name:"卢旺达"},{code:"+40",name:"罗马尼亚"},{code:"+261",name:"马达加斯加"},{code:"+960",name:"马尔代夫"},{code:"+356",name:"马耳他"},{code:"+265",name:"马拉维"},{code:"+60",name:"马来西亚"},{code:"+223",name:"马里"},{code:"+596",name:"马提尼克"},{code:"+230",name:"毛里求斯"},{code:"+1",name:"美国"},{code:"+1684",name:"美属萨摩亚群岛"},{code:"+976",name:"蒙古"},{code:"+1664",name:"蒙特塞拉特岛"},{code:"+880",name:"孟加拉国"},{code:"+51",name:"秘鲁"},{code:"+373",name:"摩尔多瓦"},{code:"+212",name:"摩洛哥"},{code:"+377",name:"摩纳哥"},{code:"+258",name:"莫桑比克"},{code:"+52",name:"墨西哥"},{code:"+264",name:"纳米比亚"},{code:"+27",name:"南非"},{code:"+505",name:"尼加拉瓜"},{code:"+977",name:"尼泊尔"},{code:"+227",name:"尼日尔"},{code:"+234",name:"尼日利亚"},{code:"+47",name:"挪威"},{code:"+351",name:"葡萄牙"},{code:"+81",name:"日本"},{code:"+46",name:"瑞典"},{code:"+41",name:"瑞士"},{code:"+503",name:"萨尔瓦多"},{code:"+685",name:"萨摩亚"},{code:"+381",name:"塞尔维亚共和国"},{code:"+232",name:"塞拉利昂"},{code:"+221",name:"塞内加尔"},{code:"+357",name:"塞浦路斯"},{code:"+248",name:"塞舌尔"},{code:"+966",name:"沙特阿拉伯"},{code:"+239",name:"圣多美和普林西比"},{code:"+1758",name:"圣卢西亚"},{code:"+378",name:"圣马力诺"},{code:"+1784",name:"圣文森特岛"},{code:"+94",name:"斯里兰卡"},{code:"+421",name:"斯洛伐克"},{code:"+386",name:"斯洛文尼亚"},{code:"+268",name:"斯威士兰"},{code:"+597",name:"苏里南"},{code:"+252",name:"索马里"},{code:"+992",name:"塔吉克斯坦"},{code:"+886",name:"台湾"},{code:"+66",name:"泰国"},{code:"+255",name:"坦桑尼亚"},{code:"+676",name:"汤加"},{code:"+1868",name:"特立尼达和多巴哥"},{code:"+216",name:"突尼斯"},{code:"+90",name:"土耳其"},{code:"+993",name:"土库曼斯坦"},{code:"+502",name:"危地马拉"},{code:"+58",name:"委内瑞拉"},{code:"+673",name:"文莱"},{code:"+256",name:"乌干达"},{code:"+380",name:"乌克兰"},{code:"+598",name:"乌拉圭"},{code:"+998",name:"乌兹别克斯坦"},{code:"+30",name:"希腊"},{code:"+34",name:"西班牙"},{code:"+65",name:"新加坡"},{code:"+64",name:"新西兰"},{code:"+36",name:"匈牙利"},{code:"+1876",name:"牙买加"},{code:"+374",name:"亚美尼亚"},{code:"+967",name:"也门"},{code:"+964",name:"伊拉克"},{code:"+98",name:"伊朗"},{code:"+972",name:"以色列"},{code:"+39",name:"意大利"},{code:"+91",name:"印度"},{code:"+62",name:"印度尼西亚"},{code:"+44",name:"英国"},{code:"+962",name:"约旦"},{code:"+84",name:"越南"},{code:"+260",name:"赞比亚"},{code:"+235",name:"乍得"},{code:"+350",name:"直布罗陀"},{code:"+56",name:"智利"},{code:"+236",name:"中非共和国"},{code:"+86",name:"中国"},{code:"+853",name:"中国澳门特别行政区"},{code:"+852",name:"中国香港特别行政区"}],defaultCountryCode:"86",defaultCountryName:"中国"}).factory("UtilTools",["$q","$http","$timeout",function(e,t,o){var n={noopPromise:function(){var t=e.defer();return o(function(){t.resolve("")},1e3),t.promise},encodeUriQuery:function(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")},toKeyValue:function(e){var t=this,o=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){o.push(t.encodeUriQuery(n,!0)+(e===!0?"":"="+t.encodeUriQuery(e,!0)))}):o.push(t.encodeUriQuery(n,!0)+(e===!0?"":"="+t.encodeUriQuery(e,!0)))}),o.length?o.join("&"):""}};return n}]),accountAppServices.factory("Request",["$http","$q","Config","UtilTools","Utils","User",function(e,t,o,n,i,a){var r=o.baseUrl,c=(o.apiUrl,o.openUrl),s=(o.baseHost,o.headconfig),l=o.bindAccountURL;o.hasBoundURL;return{wxBind:function(o){var i=t.defer(),c=n.toKeyValue(o);return e.post(r+"wechat/applet/bind",c,s).success(function(e){i.resolve(e),a.setUser(e.data)}).error(function(){i.reject("网络异常!")}),i.promise},wxRegisterBind:function(o){var i=t.defer(),c=n.toKeyValue(o);return e.post(r+"wechat/applet/register",c,s).success(function(e){i.resolve(e),a.setUser(e.data)}).error(function(){i.reject("网络异常!")}),i.promise},checkMobile:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"cellphone/?"+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},checkMail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"email/?"+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},checkNickName:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"nickname/?"+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},sendMobileCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"cellphone/?m=post",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},checkMobileCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"cellphone/?m=post",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},getUserChecks:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"cellphone/?"+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},register:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},registerWechat:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"wechat/register/",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},login:function(o){var i=t.defer(),c=n.toKeyValue(o);return e.post(r+"session/?m=post",c,s).success(function(e){i.resolve(e),a.setUser(e.data)}).error(function(){i.reject("网络异常!")}),i.promise},loginWechat:function(o){var i=t.defer(),c=n.toKeyValue(o);return e.post(r+"wechat/?m=post",c,s).success(function(e){i.resolve(e),a.setUser(e.data)}).error(function(){i.reject("网络异常!")}),i.promise},logout:function(o){var n=t.defer();return e.post(r+"session/?m=delete","").success(function(e){n.resolve(e)}).error(function(){n.reject("网络异常!")}),n.promise},checkWechatBind:function(){var o=t.defer();return e.get(r+"wechat/status","").success(function(e){o.resolve(e)}).error(function(){o.reject("网络异常!")}),o.promise},logoutWechat:function(o){var n=t.defer();return e.post(r+"wechat/?m=delete","").success(function(e){n.resolve(e)}).error(function(){n.reject("网络异常!")}),n.promise},checkLoginCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/captcha/?m=post&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},updateUserPassword:function(o){var i=t.defer(),a=n.toKeyValue(o),c=r+"w/password/?m=put";return o.uid&&(c=r+"users/password/?m=put&uid="+o.uid),o.username&&(c=r+"users/password/?m=put&username="+o.username),e.post(c,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},updateUserNickname:function(o){var i=t.defer(),a=n.toKeyValue(o),c=r+"w/nickname/?m=put";return o.uid&&(c=r+"users/nickname/?m=put&uid="+o.uid),o.username&&(c=r+"users/nickname/?m=put&username="+o.username),e.post(c,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},uploadImageForAvatar:function(e){var o=t.defer(),n=r+"w/avatar/upload";return $.ajaxFileUpload({url:n,fileElementId:e,dataType:"json",success:function(e){o.resolve(e)},error:function(e){o.reject(e)}}),o.promise},updataUserAvatar:function(o){var i=t.defer(),a=r+"w/avatar";o.uid&&(a=r+"users/avatar/?uid="+o.uid),o.username&&(a=r+"users/avatar/?username="+o.username);var c={};o.cropped?c.avatar=o.imgData:(c.avatar="from-upload",c["Crop-X"]=Math.round(o.coordData.x),c["Crop-Y"]=Math.round(o.coordData.y),c["Crop-Width"]=Math.round(o.coordData.w),c["Crop-Height"]=Math.round(o.coordData.h));var l=n.toKeyValue(c);return e.post(a,l,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},updateUserEmail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/email/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},updateUserMobile:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/cellphone/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getUserAuths:function(o){var n=t.defer(),i=r+"w/protection/?m=get";return e.post(i,"").success(function(e){n.resolve(e)}).error(function(){n.reject("网络异常!")}),n.promise},getNoLoginAuths:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/protection/?m=get&"+a,"").success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},sendUpdateCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/token/?m=post&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},checkUpdateCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/token/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},sendNewMobileCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/cellphone/?m=post&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},sendNewEmail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/email/?m=post&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},modifyMail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/email/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getQuestions:function(){var o=t.defer();return e.post(r+"config/security-questions/?m=get","").success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},updateUserQuestion:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/secques/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},activeUserEmail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"users/active/?m=put&uid="+o.uid,a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getSettings:function(){var o=t.defer();return e.post(r+"w/?m=get","").success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},getWechatOpenId:function(){var n=t.defer();return e.get(r+"wechat/openid","").success(function(e){e.errno==o.errnoMap.OK&&e.data.cookie?n.resolve(e.data):n.reject(e)}).error(function(e){n.reject(e)}),n.promise},wechatLogin:function(e){e&&""!=e||(e=o.officialURL),e=i.unicode(e),l=i.unicode(l),window!=top?top.location.href=r+"oauth/wechat?return_url="+e+"&bind_url="+l:location.href=r+"oauth/wechat?return_url="+e+"&bind_url="+l},qqLogin:function(e){e&&""!=e||(e=o.officialURL),e=i.unicode(e),l=i.unicode(l),window!=top?top.location.href=r+"oauth/qq?return_url="+e+"&bind_url="+l:location.href=r+"oauth/qq?return_url="+e+"&bind_url="+l},weiboLogin:function(e){e&&""!=e||(e=o.officialURL),e=i.unicode(e),l=i.unicode(l),window!=top?top.location.href=r+"oauth/weibo?return_url="+e+"&bind_url="+l:location.href=r+"oauth/weibo?return_url="+e+"&bind_url="+l},alipayLogin:function(e){e&&""!=e||(e=o.officialURL),e=i.unicode(e),l=i.unicode(l),window!=top?top.location.href=r+"oauth/alipay?return_url="+e+"&bind_url="+l:location.href=r+"oauth/alipay?return_url="+e+"&bind_url="+l},getBindInfo:function(){var o=t.defer();return e.get(r+"ident/info","").success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},sendBindMobileCaptcha:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"ident/cellphone",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},bindMobile:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"ident/bindCellphone/",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},bindPassword:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"ident/create/",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},getDeviceData:function(){var o=t.defer();return e.get(r+"devices/","").success(function(e){o.resolve(e)}).error(function(){o.reject("网络异常!")}),o.promise},getDeviceIsOnlineStatus:function(o){var i=t.defer(),a="&timestamp="+(new Date).getTime(),c=n.toKeyValue(o);return e.get(r+"devices/online/?"+c+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},getDeviceIsBankbindStatus:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.get(r+"devices/isbankbind/?"+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},checkCloudPassword:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"w/password/check",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},deleteDevice:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"devices/delete",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},getSingleDeviceInfo:function(o){var i=t.defer(),a="&timestamp="+(new Date).getTime(),c=n.toKeyValue(o);return e.get(r+"devices/info/?"+c+a,"").success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},sendAccountEmail:function(o){var i=t.defer(),a=n.toKeyValue(o);return e.post(r+"w/active",a,s).success(function(e){i.resolve(e)}).error(function(){i.reject("网络异常!")}),i.promise},getThirdPartyList:function(){var o=t.defer();return e.get(r+"oauth/platforms").success(function(e){o.resolve(e)}).error(function(){o.resolve(null)}),o.promise},getAuthAppList:function(){var o=t.defer();return e.get(c+"oauth/users/clients/third_grant",{withCredentials:!0}).success(function(e){o.resolve(e)}).error(function(){o.resolve(null)}),o.promise},revokeAuthorization:function(o){var n=t.defer();return e["delete"](c+"oauth/users/clients/grant/"+o,{withCredentials:!0}).success(function(e){n.resolve(e)}).error(function(){n.reject("网络异常!")}),n.promise},unbindThirdPartyApp:function(o){var n=t.defer();return e["delete"](r+"oauth/"+o).success(function(e){n.resolve(e)}).error(function(){n.reject("网络异常!")}),n.promise}}}]),accountAppServices.factory("User",["md5","Config",function(e,t){var o=t.baseProtocolHost;return location.host.indexOf("account.smartisan.com")<0&&(o="https://account.smartisan.com"),{user:{uid:"",nickname:"",cellphone:""},captchaUrl:o+"/v2/session/captcha/?"+ +new Date,refreshCaptcha:function(){var e=this,t=e.captchaUrl;return t=t.lastIndexOf("?")>0?t+"&"+ +new Date:t+"?"+ +new Date,e.captchaUrl=t},setUser:function(t){if(t&&t.uid){this.user.uid=t.uid,t.nickname?this.user.nickname=t.nickname:"",t.cellphone?this.user.cellphone=t.cellphone:"";var o="smartisancid",n=14,i=e.createHash(this.user.uid+"");i=e.createHash(i+"").slice(-n);var a=7;$.cookies.set(o,i,{expiresAt:new Date((new Date).getTime()+864e5*a),domain:".smartisan.com"})}},isLoggedIn:function(){return!!this.user.uid}}}]),accountAppServices.factory("Loading",function(){return{start:function(){$(".loading").show()},done:function(){$(".loading").hide()}}}),accountAppServices.factory("Validate",function(){return{checkErrNumber:function(e,t){var o,n=0;e.errAnimation={},angular.forEach(t.$error,function(e){angular.forEach(e,function(e){e.$invalid&&(o=e.$name,n++)})}),1==n&&(e.errAnimation[o]=!0)}}}),accountAppServices.factory("Utils",["$rootScope","$q","$http","$location",function(e,t,o,n){var i={};return i.truncateChars=function(e,t,o,n){if(e){var i=e.replace(/[\u4e00-\u9fa5\s]/g,"**").length,a=[],r=0;if(n){var c=$("<div></div>").html(e);e=c.text(),c=null}if(i<=t)return e;for(var s=0;s<i;s++){var l=e.charAt(s);if(r+=/[^\x00-\xff]/.test(l)?2:1,a.push(l),r>=t)break}return o?a.join("")+"...":a.join("")}return""},i.encodeUriQuery=function(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")},i.toKeyValue=function(e){var t=this,o=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){o.push(t.encodeUriQuery(n,!0)+(e===!0?"":"="+t.encodeUriQuery(e,!0)))}):o.push(t.encodeUriQuery(n,!0)+"="+t.encodeUriQuery(e,!0))}),o.length?o.join("&"):""},i.isMobile=function(){var e=window.devicePixelRatio||1;return $(window).width()<=736&&(screen.width<=736||e>=2)},i.isWeixin=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)},i.isMobileQQ=function(){var e=navigator.userAgent.toLowerCase();return"qq/"==e.match(/qq\//i)},i.isIphone=function(){var e=navigator.userAgent.toLowerCase();return"iphone"==e.match(/iphone/i)},i.isAndroid=function(){var e=navigator.userAgent.toLowerCase();return"android"==e.match(/android/i)},i.unicode=function(e){return e?encodeURIComponent(decodeURIComponent(e)):e},i.getUrlUnicode=function(){return encodeURIComponent(n.absUrl())},i.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,o={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};return o.gecko="Gecko"==navigator.product&&!o.webkit&&!o.opera&&!o.ie,o},i}]),accountAppServices.factory("Dialog",["$compile",function(e){var t={dialog:".m-dialog",backdrop:".m-dialog-backdrop",modal:".m-dialog-modal",content:".m-dialog-content",header:".m-dialog-header",close:'[data-dismiss="true"]',headline:".m-dialog-headline",body:".m-dialog-body",footer:".m-dialog-footer"},o={fadein:"fadein",shadow:"m-dialog-shadow",overflow:"m-dialog-open",hide:"hide",dialog:"m-dialog",backdrop:"m-dialog-backdrop",content:"m-dialog-content",bubble:"m-bubble",toast:"m-toast",bubbleStatus:["loading","success","error"]},n={init:{},defaultSetting:{headline:"操作",size:!1,backdrop:!0,shadow:!0,html:"...none...",id:"",compile:!0,replace:!1},defaultBubbleSetting:{status:"",msg:"暂无消息",close:!1,replace:!1,reload:!1,time:2e3},defaultToastSetting:{msg:"暂无消息",close:!0,reload:!1,time:2e3,backdrop:!1},open:function(i,a){var r=$.extend(!0,{},n.defaultSetting,i);r.headline&&$(t.headline).html(r.headline),r.size&&$(t.content).addClass(r.size),r.backdrop||$(t.backdrop).addClass(o.hide),r.shadow&&$(t.content).addClass(o.shadow),r.compile&&r.id?r.html=e($("#"+r.id).html())(a):r.html=$("#"+r.id).html(),$(t.body).html(r.html),r.replace||setTimeout(function(){$(t.dialog).addClass(o.fadein)},300)},close:function(){$(t.dialog).removeClass(o.fadein),$(t.headline).html(""),$(t.body).html(""),setTimeout(function(){$(t.dialog).attr("class",o.dialog),$(t.backdrop).attr("class",o.backdrop),$(t.content).attr("class",o.content)},300)},bubble:function(e){var i=$.extend(!0,{},n.defaultBubbleSetting,e),a='<i class="m-'+i.status+'"></i>';a+=i.msg,i.replace||($(t.dialog).addClass(o.bubble),$(t.headline).html("")),i.reload&&setTimeout(function(){window.location.reload()},i.time),i.close&&setTimeout(function(){
n.close()},i.time),$(t.body).html(a),$(t.dialog).hasClass(o.fadein)||setTimeout(function(){$(t.dialog).addClass(o.fadein)},300)},toast:function(e){var i=$.extend(!0,{},n.defaultToastSetting,e),a=i.msg;i.backdrop||$(t.backdrop).addClass(o.hide),i.reload&&setTimeout(function(){window.location.reload()},i.time),i.close&&setTimeout(function(){n.close()},i.time),$(t.body).html(a),$(t.dialog).addClass(o.toast),$(t.dialog).hasClass(o.fadein)||setTimeout(function(){$(t.dialog).addClass(o.fadein)},300)}};return $(t.dialog).on("click",t.close,n.close),$(document).on("keydown",function(e){27===e.which&&n.close()}),n}]),accountAppServices.factory("Content",["$q","Request","Filter",function(e,t,o){function n(e){var t={};if("[object Object]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e))for(var o in e)if(e.hasOwnProperty(o))if("[object Object]"===Object.prototype.toString.call(e[o]))t[o]=n(e[o]);else{var a=i(o);t[a]=e[o]}return t}function i(e){if(e.indexOf("_")>0){for(var t=e.toLowerCase().split("_"),o=1,n=t.length;o<n;o++)t[o]=t[o][0].toUpperCase()+t[o].substring(1,t[o].length);return t.join("")}return e}function a(e){var t=new Date(1e3*parseInt(e));return t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()}var r={};return r.init=function(){},r.takeUserAccount=function(){return e.all([t.getSettings(),t.getThirdPartyList(),t.getAuthAppList()]).then(function(e){var t;return t=e,e[0].errno||(t[0].data=n(e[0].data),t[0].data.cellphoneActive=0|e[0].data.cellphoneActive,t[0].data.emailActive=0|e[0].data.emailActive,t[0].data.verifiedEmail=e[0].data.email&&e[0].data.emailActive,t[0].data.unVerifiedEmail=e[0].data.email&&!e[0].data.emailActive,t[0].data.secquesActive=0|!!e[0].data.secques),t},function(e){})},r.takeDeviceData=function(){return t.getDeviceData().then(function(e){if(!e.errno)for(var t in e.data){e.data[t]=n(e.data[t]),"bind"===t&&(e.data[t]=r.parseDeviceIsOnline(e.data[t]));for(var i in e.data[t]){var c=o.getMobileBrand(e.data[t][i].model),s=e.data[t][i].color||"black";"steel"===s&&(s="white"),"golden"!==s&&"gold"!==s||(s="golden"),"M1"!==c||s.match(/^(golden|white)$/)||(s="white"),"U1"!==c||s.match(/^(black|white|beige)$/)||(s="black"),"T2"!==c||s.match(/^(black|white)$/)||(s="black"),"T1"!==c||s.match(/^(black|white)$/)||(s="black"),"Pro2"!==c||s.match(/(red|gold|black|white)/)||(s="golden"),"Pro2"===c&&s.match(/red$/)&&(s="red"),"Pro2"===c&&s.match(/gold/)&&(s="golden"),"U3"===c&&s.match(/red$/)&&(s="red"),"U3"===c&&s.match(/gold/)&&(s="golden"),"R1"!==c||s.match(/(black|white)/)||(s="black"),e.data[t][i].color=s,e.data[t][i].brand=c,e.data[t][i].date=a(e.data[t][i].updateTime)||""}}return e},function(e){})},r.parseDeviceIsOnline=function(e){for(var o in e)!function(o){t.getDeviceIsOnlineStatus({id:e[o].id}).then(function(t){if(!t.errno)switch(t.data){case 0:e[o].isOnline=0,e[o].isOnlineCn="离线",e[o].isOnlineColor="off";break;case 1:e[o].isOnline=1,e[o].isOnlineCn="在线",e[o].isOnlineColor="on";break;default:e[o].isOnline=0,e[o].isOnlineCn="未知",e[o].isOnlineColor="off"}},function(e){console.log("device id "+o+"have no status of online!",e)})}(o);return e},r}]),accountAppServices.factory("Filter",["Config",function(e){var t={};return t.init=function(){},t.cellphoneFilter=function(e){var t=e.length,o=e.substring(0,t-8),n=e.slice(-4);return o+"****"+n},t.emailFilter=function(e){var t=e.indexOf("@"),o=e.substring(0,t),n=e.substring(t),i=e,a=o[0],r=1,c=o.length;if(c>3){for(r;r<c-1;r++)a+="*";a+=o[c-1],i=a+n}return i},t.emailLocation=function(t){var o="";return t&&(t=""+t,o=t.replace(/^.+\@/g,""),o=e.mailUrl[o]?e.mailUrl[o]:"http://mail."+o),o},t.getMobileBrand=function(e){switch(e){case"sm901":case"sm919":return"M1";case"sm801":return"T2";case"sm701":case"sm705":return"T1";case"yq601":case"yq603":case"yq605":case"yq607":return"U1";case"od101":case"od103":case"od105":case"yq607":return"Pro";case"os105":case"os103":return"Pro2";case"oc105":case"oc106":return"U3";case"de106":return"R1";default:return"T1"}},t.checkIsEmptyObject=function(e){var t;for(t in e)return!1;return!0},t.changeToArray=function(e){var t=[];for(var o in e)t.push(e[o]);return t},t}]),accountAppServices.factory("GTMAnalyticsService",function(){var e=function(){window.dataLayer&&window.dataLayer.push({event:"gtm-register-success"})};return{registerSuccess:e}}),accountAppControllers.controller("MainCtrl",["$scope","$rootScope","$http","$timeout","$location","$window","User","Request","Config","Utils",function(e,t,o,n,i,a,r,c,s,l){if(t.isRefresh=!0,t.isMobile=l.isMobile(),t.browser=l.browser(),e.util={},t.isRefresh&&!l.isMobile()){var u=$(".dialog"),d=u.css("margin-top");e.$on("$viewContentLoaded",function(){n(function(){var e=$(".dialog"),t=$(".copyright").outerHeight();"0px"!=e.css("margin-top")&&d!=e.css("margin-top")||e.css({"margin-top":-(e.outerHeight()+t)/2})})})}if(/embed/.test(i.$$path)&&a.parent!==a){var p=i.search().origin;s.legalOrigin.test(p)?t.targetOrigin=p:t.targetOrigin="http://store.smartisan.com"}else $("body").removeClass("bg-none"),$(".wrapper").removeClass("bg-none");$(window).on("keydown",function(e){if(!t.isEmbedCloud&&!t.isEmbedBbsTmp){var e=e||window.event;27==e.keyCode&&t.targetOrigin&&a.parent.postMessage("dialogClose",t.targetOrigin)}}),$(".wrapper").on("click",function(e){if(!t.isEmbedCloud&&!t.isEmbedBbsTmp){e.stopPropagation();var o=e.target;$(o).hasClass("wrapper")&&a.parent!=a&&a.parent.postMessage("dialogClose",t.targetOrigin)}}),$(".dialog .title .close").on("click",function(e){t.isEmbedCloud||a.parent.postMessage("dialogClose",t.targetOrigin)})}]),accountAppControllers.controller("RegisterCtrl",["$scope","$rootScope","$window","$http","$location","$timeout","$interval","Request","Config","User","Validate","Loading","Utils","GTMAnalyticsService",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f){t.dialogTitle="注册 Smartisan ID";var m={};"miniprogram"===window.__wxjs_environment&&(m.type="miniprogram",m.authToken=i.search().authToken),e.invalid={},e.focus={},e.showBtn=!0,e.agreed=!1,e.user={},e.util.submitted=!1;var h=/embed/.test(i.$$path),g=i.search().return_url;if(1==t.isWechatLogin&&g)return void o.location.replace(g);t.isEmbedBbsTmp&&(e.showRePwd=function(){e.needRePassword=!0,o.parent!==o&&o.parent.postMessage("showSlideDown",t.targetOrigin)}),e.cccList=s.cccList,e.ccc=s.defaultCountryCode,e.country=s.defaultCountryName;var v=!1;e.showList=function(e){v||($(".country-list").show(),e.stopPropagation(),v=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),v=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.form.mobile.$setValidity("mobile",!0),e.form.mobile.$setValidity("mobileRegistered",!0),e.validateMobile()},e.captchaNeeded=!1,e.register=function(){if(e.util.submitted=!0,e.form.$invalid){if(e.errAnimation={},e.form.mobile.$invalid)return void(e.errAnimation.mobile=!0);if(e.form.captcha.$invalid)return;if(e.form.verification.$invalid)return;if(e.form.password.$invalid)return void(e.errAnimation.password=!0);if(e.form.repassword.$invalid)return void(e.errAnimation.repassword=!0)}else{if(!e.agreed)return void(e.animationTip=!0);var n=t.isWechat?c.registerWechat:c.register;"miniprogram"==m.type&&(n=c.wxRegisterBind),d.start(),e.clicked=!0,n({"user[cellphone]":"+"+e.ccc+" "+e.user.mobile,"ext[cellphone_code]":e.user.verification,"ext[login]":t.isEmbedBbs||t.isEmbedBbsTmp?"true":"false","user[password]":e.user.password,authToken:m.authToken}).then(function(n){switch(d.done(),e.clicked=!1,+n.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.ILLEGAL_VCODE:case s.errnoMap.INVALID_VCODE:e.invalid.mobileCaptchaValid=!1;break;case s.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,a(function(){e.reloadCaptcha(n.data.captcha),e.focus.captcha=!0},500);break;case s.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1;break;case s.errnoMap.OK:window.dataLayer&&window.dataLayer.push({event:"gtm-register-success"}),h?o.parent!==o&&o.parent.postMessage("isRegistered",t.targetOrigin):i.path("/result/register").search({return_url:p.unicode(g)})}},function(t){d.done(),e.clicked=!1,e.captchaNeeded=!0})}};var b=function(){var t=60;e.timer=t,e.showBtn=!1,r(function(){e.timer--},1e3,t).then(function(){e.showBtn=!0})};e.resend=function(){if(e.captchaSubmitted=!0,e.form.mobile.$invalid)return e.errAnimation={},void(e.errAnimation.mobile=!0);if(e.captchaNeeded&&e.form.captcha.$invalid)return e.errAnimation={},void(e.errAnimation.captcha=!0);var t={cellphone:"+"+e.ccc+" "+e.user.mobile};e.captchaNeeded&&(t.captcha=e.user.captcha),c.sendMobileCaptcha(t).then(function(t){if(e.captchaSubmitted=!1,0!=t.errno)switch(+t.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.ILLEGAL_CELLPHONE:e.invalid.mobile=!1;break;case s.errnoMap.ILLEGAL_VCODE:case s.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1;break;case s.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,a(function(){e.reloadCaptcha(t.data.captcha),e.focus.captcha=!0},500);break;case s.errnoMap.REFRECH_VCODE:e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case s.errnoMap.VCODE_TOO_OFTEN:b()}else b()},function(e){})},e.reloadCaptcha=function(t){e.loginCaptchaUrl=t?t:l.refreshCaptcha();var o=$(".tips-verifycon");o.addClass("active"),setTimeout(function(){o.removeClass("active")},600)},e.validateMobile=function(){if(!e.form.mobile.$invalid){if("86"==e.ccc){if(!s.regExp.isCnMobile.test(e.user.mobile))return void e.form.mobile.$setValidity("mobile",!1)}else if(!s.regExp.isMobile.test(e.user.mobile))return void e.form.mobile.$setValidity("mobile",!1);c.checkMobile({m:"get",cellphone:"+"+e.ccc+" "+e.user.mobile,action:"check"}).then(function(t){if(0!=t.errno)switch(t.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.ILLEGAL_CELLPHONE:e.invalid.mobile=!1}},function(e){})}},e.validateMobileCaptcha=function(){if(!e.form.verification.$invalid)return e.form.mobile.$invalid?void(e.invalid.mobileCaptchaValid=!1):void c.checkMobileCaptcha({action:"renew",cellphone:"+"+e.ccc+" "+e.user.mobile,cellphone_code:e.user.verification}).then(function(t){if(0!=t.errno)switch(t.errno){case s.errnoMap.ILLEGAL_VCODE:case s.errnoMap.INVALID_VCODE:e.invalid.mobileCaptchaValid=!1;break;case s.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,a(function(){e.reloadCaptcha(t.data.captcha),e.focus.captcha=!0},500);break;case s.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1}},function(e){})},e.toLogin=function(){if(h)i.path("/login/embed");else{var e=i.search().v;if(e&&"2"==e)i.path("/v2/login").search({return_url:p.unicode(g)});else{if(s.regExp.isSafeUrl.test(decodeURIComponent(g))){if(g.indexOf(s.baseHost)>=0){var t=g.split("#");t[1]&&i.path(t[1])}else/bbs.smartisan.com/i.test(g)?o.location.replace("http://bbs.smartisan.com/member.php?mod=logging&action=login&referer="):o.location.replace(g);return}i.path("/login")}}}}]),accountAppControllers.controller("LoginCtrl",["$scope","$rootScope","$http","$location","$window","$timeout","User","Request","$routeParams","$route","Config","Validate","Loading","Utils",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f){t.dialogTitle="登录",e.invalid={},e.focus={},e.util.submitted=!1;var m=/embed/.test(n.$$url),h=n.search().return_url,g=n.search().username,v=new RegExp("^http://www.smartisan.com/special/#/20151111","i");if(v.test(decodeURIComponent(h))&&(t.is1111=!0,t.backToLast=function(){i.history.back(1)}),1==t.isWechatLogin&&h)return void i.location.replace(h);t.isEmbedBbs&&(t.dialogTitle="使用欢喜云账户登录锤子论坛"),e.registerText=t.isEmbedNotes||t.isEmbedContacts||t.isEmbedRadar?"注册欢喜云账户":"注册新账户",e.user={},e.remembered=t.isWechat,m&&g&&($(".cloud .title").addClass("locked"),e.user.username=g,$(".username .placeholder").hide()),t.showCcc&&(e.cccList=u.cccList,e.ccc=u.defaultCountryCode,e.country=u.defaultCountryName),e.switchModel=function(){t.showCcc=!t.showCcc,t.isRefresh=!0,l.reload()};var b=!1;e.showList=function(e){b||($(".country-list").show(),e.stopPropagation(),b=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),b=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.invalid.username=!0,e.invalid.nameValid=!0,e.invalid.passwordValid=!0,e.util.submitted=!1},e.login=function(){if(e.util.submitted=!0,e.form.$invalid){if(e.errAnimation={},e.form.username.$invalid)return void(e.errAnimation.username=!0);if(e.form.password.$invalid)return void(e.errAnimation.password=!0)}else{var o={};o.username=e.user.username,o.password=e.user.password,e.user.captcha&&(o.captcha=e.user.captcha),e.showCcc&&u.regExp.isMobile.test(o.username)&&(o.username="+"+e.ccc+" "+o.username),e.remembered&&!t.isWechat&&(o.extended_login=1);var r=t.isWechat&&e.remembered?c.loginWechat:c.login;p.start(),r(o).then(function(o){switch(p.done(),o.errno){case u.errnoMap.ILLEGAL_PASSWORD:case u.errnoMap.INVALID_PASSWORD:e.invalid.passwordValid=!1,e.focus.password=!0;break;case u.errnoMap.PARAMETER_ERROR:case u.errnoMap.ILLEGAL_CELLPHONE:case u.errnoMap.INVALID_CELLPHONE:case u.errnoMap.INVALID_UID:case u.errnoMap.INVALID_EMAIL:case u.errnoMap.UNREGISTERED_NICKNAME:e.invalid.nameValid=!1;break;case u.errnoMap.ILLEGAL_VCODE:case u.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case u.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,(t.isEmbedBbs||t.isEmbedBbsTmp)&&i.parent!==i&&i.parent.postMessage("showSlideDown",t.targetOrigin),e.loginCaptchaUrl=o.data.captcha,a(function(){e.focus.captcha=!0},500);break;case u.errnoMap.REFRECH_VCODE:e.captchaNeeded=!0,e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case u.errnoMap.FAILED_LOGIN_LIMIT:e.invalid.passwordValid=!1,e.focus.password=!0,e.captchaNeeded=!0,(t.isEmbedBbs||t.isEmbedBbsTmp)&&i.parent!==i&&i.parent.postMessage("showSlideDown",t.targetOrigin),e.reloadCaptcha(o.data.captcha);break;case u.errnoMap.OK:if(m)i.parent!==i&&i.parent.postMessage("isLoggedIn",t.targetOrigin);else{if(u.regExp.isSafeUrl.test(decodeURIComponent(h))){if(h.indexOf(u.baseHost)>=0){var r=h.split("#");r[1]&&n.path(r[1])}else i.location.replace(h);return}var c=s.action;switch(c){case"modifyPassword":n.path("/"+c);break;case"modifyMobile":case"modifyMail":case"modifyQuestion":n.path("/auth/"+c);break;default:n.path("/result/login")}}}},function(t){p.done(),e.captchaNeeded=!0})}},e.toRegister=function(){m?t.isEmbedCloud?e.toRegisterWithReturn():n.path("/register/embed"):n.path("/register")},e.toRegisterWithReturn=function(){i.parent.location.replace(u.baseProtocolHost+"/#/register?return_url="+f.unicode(t.targetOrigin))},e.forgotPassword=function(){m?i.open(u.baseProtocolHost+"/#/forgotPassword"):n.path("/forgotPassword")},e.reloadCaptcha=function(t){var o=t||e.loginCaptchaUrl;o=o.lastIndexOf("?")>0?o+"&"+ +new Date:o+"?"+ +new Date,e.loginCaptchaUrl=o}}]),accountAppControllers.controller("LoginV2Ctrl",["$scope","$rootScope","$http","$location","$window","$timeout","User","Request","$routeParams","$route","Config","Validate","Loading","userInfo","Utils",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f,m){function h(){if(window.PasswordCredential&&w===!0&&navigator.credentials&&navigator.credentials.store){var t=new PasswordCredential({id:e.user.username,password:e.user.password});navigator.credentials.store(t).then(function(){})}}function g(o,r){switch(p.done(),o.errno){case u.errnoMap.ILLEGAL_PASSWORD:case u.errnoMap.INVALID_PASSWORD:e.invalid.passwordValid=!1,e.focus.password=!0;break;case u.errnoMap.PARAMETER_ERROR:case u.errnoMap.ILLEGAL_CELLPHONE:case u.errnoMap.INVALID_CELLPHONE:case u.errnoMap.INVALID_UID:case u.errnoMap.INVALID_EMAIL:case u.errnoMap.UNREGISTERED_NICKNAME:e.invalid.nameValid=!1;break;case u.errnoMap.ILLEGAL_VCODE:case u.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case u.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,e.loginCaptchaUrl=o.data.captcha,a(function(){e.focus.captcha=!0},500);break;case u.errnoMap.REFRECH_VCODE:e.captchaNeeded=!0,e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case u.errnoMap.FAILED_LOGIN_LIMIT:e.invalid.passwordValid=!1,e.focus.password=!0,e.captchaNeeded=!0,e.reloadCaptcha(o.data.captcha);break;case u.errnoMap.OK:if(r===!0&&h(),!t.isMobile&&o.data.alarm)return void n.path("/warning/safety").search({return_url:decodeURIComponent(E)});if(u.regExp.isSafeUrl.test(decodeURIComponent(E))){if(E.indexOf(u.baseHost)>=0){var c=E.split("#");c[1]&&n.path(c[1])}else i.location.replace(decodeURIComponent(E));return}var l=s.action;switch(l){case"modifyPassword":n.path("/"+l);break;case"modifyMobile":case"modifyMail":case"modifyQuestion":n.path("/auth/"+l);break;default:n.path("/result/login")}}}function v(){var o="",n="注册 Smartisan ID",i="",a="忘记密码",r=decodeURIComponent(E);/cloud.smartisan.com/i.test(r)?/notes/i.test(r)?(o="锤子便签",i="logo-notes"):/contacts/i.test(r)?(o="联系人",i="logo-contacts"):/radar/i.test(r)?(o="查找手机",i="logo-radar"):C?(i="logo-locked",o="解锁",e.user.username=C,$(".username .placeholder").hide()):(i="logo-cloud",o="欢喜云"):/bbs.smartisan.com/i.test(r)?(o="锤子科技官方论坛",i="logo-bbs"):o=/(smartisan.com\/?\#?\/shop)|(store.smartisan.com)/i.test(r)?"在线商城":/dev.smartisan.com/i.test(r)?"开发者中心":"官网",t.isMobile?(n="注册",o="登录"+o):(o="使用 Smartisan ID 登录"+o,a+="？"),t.dialogTitle=o,"miniprogram"==b.type&&(t.dialogTitle="绑定 Smartisan ID"),t.loginLogoClass=i,e.registerText=n,e.forgetText=a}var b={};e.isMiniprogram=!1,"miniprogram"===window.__wxjs_environment&&(b.type="miniprogram",b.authToken=n.search().authToken,e.isMiniprogram=!0);var w=!0;t.dialogTitle="使用 Smartisan ID 登录锤子商城",e.registerText="注册 Smartisan ID",e.invalid={},e.focus={},e.util.submitted=!1;var C=n.search().username,E=n.search().return_url;if(E&&""!=E&&!u.regExp.isSafeUrl.test(decodeURIComponent(E))&&(E=m.unicode(u.officialURL)),1==t.isWechatLogin&&E&&"miniprogram"!=b.type)return void i.location.replace(E);e.user={},e.remembered=!0,t.showCcc&&(e.cccList=u.cccList,e.ccc=u.defaultCountryCode,e.country=u.defaultCountryName),e.switchModel=function(){t.showCcc=!t.showCcc,t.isRefresh=!0,l.reload()};var y=!1;e.showList=function(e){y||($(".country-list").show(),e.stopPropagation(),y=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),y=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.invalid.username=!0,e.invalid.nameValid=!0,e.invalid.passwordValid=!0,e.util.submitted=!1},e.login=function(){if(e.util.submitted=!0,e.form.$invalid){if(e.errAnimation={},e.form.username.$invalid)return void(e.errAnimation.username=!0);if(e.form.password.$invalid)return void(e.errAnimation.password=!0)}else{var o={};o.username=e.user.username,o.password=e.user.password,e.user.captcha&&(o.captcha=e.user.captcha),e.showCcc&&u.regExp.isMobile.test(o.username)&&(o.username="+"+e.ccc+" "+o.username),e.remembered&&!t.isWechat&&(o.extended_login=1);var n=t.isWechat&&e.remembered?c.loginWechat:c.login;"miniprogram"==b.type&&(n=c.wxBind,o.authToken=b.authToken),p.start(),n(o).then(function(e){g(e,!0)},function(t){p.done(),e.captchaNeeded=!0})}},e.toRegister=function(){n.path("/register").search({v:"2",return_url:E,authToken:b.authToken})},e.toRegisterWithReturn=function(){i.parent.location.replace(u.baseProtocolHost+"/#/register?return_url="+m.unicode(t.targetOrigin))},e.forgotPassword=function(){n.path("/forgotPassword")},e.reloadCaptcha=function(t){var o=t||e.loginCaptchaUrl||"https://account.smartisan.com/v2/session/captcha/";o=o.lastIndexOf("?")>0?o+"&"+ +new Date:o+"?"+ +new Date,e.loginCaptchaUrl=o;var n=$(".tips-verifycon");n.addClass("active"),setTimeout(function(){n.removeClass("active")},600)},e.wechatLogin=function(){c.wechatLogin(E)},e.qqLogin=function(){c.qqLogin(E)},e.weiboLogin=function(){c.weiboLogin(E)},e.alipayLogin=function(){c.alipayLogin(E)},v(),w===!0&&navigator.credentials&&navigator.credentials.get&&"miniprogram"!=b.type&&navigator.credentials.get({password:!0}).then(function(e){if(e&&"password"==e.type){p.start();var o=u.baseUrl+"session/?m=post";t.isMobile||(o+="&alarm=1"),fetch(o,{credentials:e,method:"POST"}).then(function(e){return e.json()}).then(function(e){g(e,!1)})}})}]),accountAppControllers.controller("LogoutCtrl",["$scope","$rootScope","$http","$location","$window","$timeout","User","Request","$routeParams","Config","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l,u,d){var p=t.isWechat&&t.wechatCheckStatus||"miniprogram"===window.__wxjs_environment?c.logoutWechat:c.logout,f=/embed/.test(n.$$url),m=n.search().return_url;d.start(),p().then(function(e){if(d.done(),0==e.errno)if(f)i.parent!==i&&i.parent.postMessage("isLoggedOut",t.targetOrigin);else if(l.regExp.isSafeUrl.test(decodeURIComponent(m)))if(m.indexOf(l.baseHost)>=0){var o=m.split("#");o[1]&&n.path(o[1])}else i.location.replace(m);else n.path("/login")},function(e){d.done()})}]),accountAppControllers.controller("Logout2Ctrl",["$scope","$rootScope","$http","$location","$window","$timeout","User","Request","$routeParams","Config","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l,u,d){t.dialogTitle="退出登录";var p=/embed/.test(n.$$url),f=n.search().return_url;e.confirm=function(){var e=t.isWechat?c.logoutWechat:c.logout;d.start(),e().then(function(e){if(d.done(),0==e.errno)if(p)i.parent!==i&&i.parent.postMessage("isLoggedOut",t.targetOrigin);else if(l.regExp.isSafeUrl.test(decodeURIComponent(f)))if(f.indexOf(l.baseHost)>=0){var o=f.split("#");o[1]&&n.path(o[1])}else i.location.replace(f);else n.path("/login")},function(e){d.done()})},e.cancel=function(){p?i.parent!==i&&i.parent.postMessage("dialogClose",t.targetOrigin):i.history.length>1&&i.history.back(1)}}]),accountAppControllers.controller("AuthCtrl",["$scope","$rootScope","$http","$routeParams","$location","$window","Request","UtilTools","$interval","Config","Validate","Loading","userAuths",function(e,t,o,n,i,a,r,c,s,l,u,d,p){t.dialogTitle="安全验证",e.invalid={},e.user={},e.answer={};var f={cellphone:"通过手机短信验证身份",email:"通过邮箱验证身份",secques:"通过密码保护验证身份"};e.authType={types:[],checked:0},e.errAnimation={},e.util.submitted=!1;switch(n.channelID){case"forgotPassword":e.authType.action="FIND_PASSWORD";var m=n;m&&m.username&&(e.authType.username=m.username),e.gotoPage="modifyPassword";break;case"modifyMobile":e.authType.action="UPDATE_CELLPHONE",e.gotoPage="modifyMobile";break;case"modifyMail":e.authType.action="UPDATE_EMAIL",e.gotoPage="modifyMail";break;case"modifyQuestion":e.authType.action="UPDATE_SECQUES",e.gotoPage="modifyQuestion";break;case"modifyAvatar":e.authType.action="UPDATE_AVATAR",e.gotoPage="modifyAvatar"}var h=function(t){var o=60*(t||1);e.timer=o,e.showBtn=!1,s(function(){e.timer--},1e3,o).then(function(){e.showBtn=!0})};e.resend=function(){h(),r.sendUpdateCaptcha({"for":e.authType.action,to:e.authType.checkType,uid:t.currentUid,secret:e.secret}).then(function(e){if(e.errno==l.errnoMap.PARAMETER_ERROR)return void a.location.reload()})},e.resendEmail=function(){h(5),r.sendUpdateCaptcha({"for":e.authType.action,to:e.authType.checkType,uid:t.currentUid,secret:e.secret}).then(function(e){if(e.errno==l.errnoMap.PARAMETER_ERROR)return void a.location.reload()})},e.gotoEmail=function(){var t;angular.forEach(e.authType.types,function(e){"email"==e.type&&(t=e.value)});var o=t.split("@")[1],n=l.mailUrl[o]||"http://mail."+o+"/";window.open(n)},e.next=function(){return"secques"==e.authType.checkType?(e.current="secques",void e.changeQuestion()):(d.start(),void r.sendUpdateCaptcha({"for":e.authType.action,to:e.authType.checkType,uid:t.currentUid,secret:e.secret}).then(function(t){if(d.done(),e.util.submitted=!1,t.errno==l.errnoMap.PARAMETER_ERROR)return void a.location.reload();switch(jQuery.support.opacity&&$(".content").css({opacity:"0"}).animate({opacity:"1"},500),e.authType.checkType){case"email":e.current="email",h(5);break;case"cellphone":e.current="cellphone",angular.forEach(e.authType.types,function(t){"cellphone"==t.type&&(e.mobile=t.value)}),e.showBtn=!0,h()}},function(e){d.done()}))},e.mobileNext=function(){if(e.util.submitted=!0,t.currentToken=void 0,!e.form.$valid)return void u.checkErrNumber(e,e.form);d.start();var o={"for":e.authType.action,uid:t.currentUid};o.cellphone_code=e.user.verification,r.checkUpdateCaptcha(o).then(function(o){switch(d.done(),+o.errno){case l.errnoMap.OK:t.currentToken=o.data,i.path("/"+e.gotoPage);break;case l.errnoMap.ILLEGAL_VCODE:case l.errnoMap.INVALID_VCODE:e.invalid.mobileCaptchaValid=!1;break;case l.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1}},function(e){d.done()})},e.changeQuestion=function(){var t,o=e.questions&&e.questions.length>0?e.questions[Math.floor(2*Math.random())].v:"";e.questions=[],angular.forEach(e.authType.types,function(e){"secques"==e.type&&(t=e.value)});for(var n in t)t.hasOwnProperty(n)&&o!==t[n]&&e.questions.push({k:n,v:t[n]});e.questions.length>2&&e.questions.splice(Math.floor(3*Math.random()),1),e.answer={},e.invalid.answerInvalid=!0,e.util.submitted=!1,e.form.answer1&&(e.form.answer1.$submitted=!1),e.form.answer2&&(e.form.answer2.$submitted=!1)},e.questionConfirm=function(){if(e.util.submitted=!0,t.currentToken=void 0,e.form.answer1.$invalid)return e.errAnimation={},void(e.errAnimation.answer1=!0);if(e.form.answer2.$invalid)return e.errAnimation={},void(e.errAnimation.answer2=!0);var o={"for":e.authType.action,uid:t.currentUid};o["secans["+e.questions[0].k+"]"]=e.answer.answer1,o["secans["+e.questions[1].k+"]"]=e.answer.answer2,d.start(),r.checkUpdateCaptcha(o).then(function(o){switch(d.done(),+o.errno){case l.errnoMap.OK:t.currentToken=o.data,i.path("/"+e.gotoPage);break;case l.errnoMap.INVALID_SECANS:e.invalid.answerInvalid=!1}},function(e){d.done()})};var g=function(e){var t={},o=[];return angular.forEach(e,function(e,o){switch(e.type){case"cellphone":t.cellphone=e;break;case"email":t.email=e;break;case"secques":t.secques=e}}),t.cellphone&&o.push(t.cellphone),t.email&&o.push(t.email),t.secques&&o.push(t.secques),o},v=function(){e.gotoPage&&b()},b=function(){t.forgotPasswordMsg?w(t.forgotPasswordMsg):"0"==p.errno?w(p):C()},w=function(o){if(d.done(),e.authType.types=[],"0"==o.errno){for(var n in o.data)if(o.data[n])if("uid"==n)t.currentUid=o.data[n];else{var i={};i.type=n,i.value=o.data[n],i.desc=f[n],e.authType.types.push(i)}e.authType.types=g(e.authType.types),e.secret=o.data.secret,angular.forEach(e.authType.types,function(t,o){"cellphone"==t.type&&e.selectType(o)})}else C()};e.selectType=function(t){e.authType.checked=t,e.authType.checkType=e.authType.types[t].type};var C=function(){d.done()};v(),t.isMobile&&(e.isMobile=!0)}]),accountAppControllers.controller("ModifyPasswordCtrl",["$scope","$rootScope","$http","$location","Request","Config","Loading","Validate",function(e,t,o,n,i,a,r,c){t.dialogTitle="修改密码",e.invalid={},e.user={},e.oldRequired=!0,e.util.submitted=!1;var s=n.search();if(t.currentToken)e.oldRequired=!1;else if(s&&s.code){e.oldRequired=!1,t.currentUid=s.uid;var l={"for":"FIND_PASSWORD",uid:s.uid,email_code:s.code};i.checkUpdateCaptcha(l).then(function(e){"0"==e.errno?t.currentToken=e.data:n.path("/forgotPassword")},function(e){})}e.modify=function(){if(e.util.submitted=!0,e.oldRequired&&e.form.oldpassword.$invalid)return e.errAnimation={},void(e.errAnimation.oldpassword=!0);if(e.form.password.$invalid)return e.errAnimation={},void(e.errAnimation.password=!0);if(e.form.repassword.$invalid)return e.errAnimation={},void(e.errAnimation.repassword=!0);r.start();var o={};e.oldRequired?o={"user[password]":e.user.password,"ext[password]":e.user.oldpassword}:(o={"user[password]":e.user.password,"ext[token]":t.currentToken},t.currentUid&&(o.uid=t.currentUid),s.username&&(o.username=s.username)),i.updateUserPassword(o).then(function(t){switch(r.done(),+t.errno){case a.errnoMap.OK:n.path("/result/modifyPassword");break;case a.errnoMap.ILLEGAL_PASSWORD:case a.errnoMap.INVALID_PASSWORD:e.invalid.oldpasswordValid=!1}},function(e){r.done()})}}]),accountAppControllers.controller("ModifyMobileCtrl",["$scope","$rootScope","$http","$location","Request","$interval","Config","Loading","Validate",function(e,t,o,n,i,a,r,c,s){t.dialogTitle="修改手机",e.invalid={},e.user={},e.util.submitted=!1,e.errAnimation={};var l=n.search();e.cccList=r.cccList,e.ccc=r.defaultCountryCode,e.country=r.defaultCountryName,e.showCcc=!0;var u=!1;if(e.showList=function(e){u||($(".country-list").show(),e.stopPropagation(),u=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),u=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.invalid.mobile=!0,e.invalid.mobileRegistered=!0,e.util.submitted=!1},!t.currentToken)if(l&&l.code){t.currentUid=l.uid||"";var d={"for":"UPDATE_CELLPHONE",uid:l.uid||"",email_code:l.code};i.checkUpdateCaptcha(d).then(function(e){"0"==e.errno?t.currentToken=e.data:n.path("/auth/modifyMobile")},function(e){})}else n.path("/auth/modifyMobile");var p=function(){var t=60;e.timer=t,e.showBtn=!1,a(function(){e.timer--},1e3,t).then(function(){e.showBtn=!0})};e.resend=function(){p(),c.start(),i.sendNewMobileCaptcha({cellphone:e.newMobile,uid:t.currentUid}).then(function(e){c.done()},function(e){c.done()})},e.step1=function(){return e.util.submitted=!0,e.form.mobile.$invalid?void(e.errAnimation.mobile=!0):"86"!=e.ccc||r.regExp.isCnMobile.test(e.user.mobile)?(c.start(),void i.sendNewMobileCaptcha({cellphone:"+"+e.ccc+" "+e.user.mobile,token:t.currentToken,uid:t.currentUid}).then(function(t){switch(c.done(),+t.errno){case r.errnoMap.OK:case r.errnoMap.VCODE_TOO_OFTEN:e.current="step2",e.util.submitted=!1,e.newMobile="+"+e.ccc+" "+e.user.mobile,p();break;case r.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case r.errnoMap.ILLEGAL_CELLPHONE:e.invalid.mobile=!1;break;default:n.path("/auth/modifyMobile")}},function(){c.done()})):(e.invalid.mobile=!1,void(e.errAnimation.mobile=!0))},e.step2=function(){e.util.submitted=!0,e.form.$valid&&(c.start(),i.updateUserMobile({uid:t.currentUid,"user[cellphone]":e.newMobile,"ext[cellphone_code]":e.user.verification}).then(function(t){switch(c.done(),+t.errno){case r.errnoMap.OK:n.path("/result/modifyMobile");break;case r.errnoMap.INVALID_VCODE:case r.errnoMap.ILLEGAL_VCODE:e.invalid.mobileCaptchaValid=!1;break;case r.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1;break;default:n.path("/auth/modifyMobile")}},function(e){c.done(),n.path("/auth/modifyMobile")}))}}]),accountAppControllers.controller("ModifyMailCtrl",["$scope","$rootScope","$http","$location","Request","$interval","Config","Loading","Validate","userInfo",function(e,t,o,n,i,a,r,c,s,l){var u="修改";e.emailTips="请输入您需要更换的邮箱地址",l.errno!=r.errnoMap.OK||l.data.email&&""!=l.data.email||(u="新增",e.emailTips="请输入您需要新增的邮箱地址"),t.dialogTitle=u+"邮箱",e.emailTips="请输入您需要"+u+"的邮箱地址",t.title=u+"邮箱",e.invalid={},e.user={},e.util.submitted=!1;var d=n.search();if(!t.currentToken)if(d&&d.code){t.currentUid=d.uid||"";var p={"for":"UPDATE_EMAIL",uid:d.uid||"",email_code:d.code};i.checkUpdateCaptcha(p).then(function(e){"0"==e.errno?t.currentToken=e.data:n.path("/auth/modifyMail")},function(e){})}else n.path("/auth/modifyMail");var f=function(t){var o=60*(t||1);e.timer=o,e.showBtn=!1,a(function(){e.timer--},1e3,o).then(function(){e.showBtn=!0})};e.resend=function(){f(5),c.start(),i.sendNewEmail({email:e.newEmail,uid:t.currentUid}).then(function(e){c.done()},function(e){c.done()})},e.next=function(){return e.util.submitted=!0,e.form.$valid?(c.start(),void i.modifyMail({uid:t.currentUid,"user[email]":e.user.mail,"ext[token]":t.currentToken}).then(function(o){switch(c.done(),+o.errno){case r.errnoMap.OK:e.submitted=!1,e.newEmail=e.user.mail,e.current="step2",t.dialogTitle=u+"邮箱成功",f(5);break;case r.errnoMap.REGISTERED_EMAIL:e.invalid.emailRegistered=!1;break;case r.errnoMap.ILLEGAL_EMAIL:e.invalid.mail=!1;break;case r.errnoMap.VCODE_TOO_OFTEN:e.submitted=!1,e.newEmail=e.user.mail,e.current="step2",t.dialogTitle=u+"邮箱成功",f(5);break;default:n.path("/auth/modifyMail")}},function(e){c.done()})):void s.checkErrNumber(e,e.form)},e.gotoEmail=function(){var t=e.newEmail,o=t.split("@")[1],n=r.mailUrl[o]||"http://mail."+o+"/";
window.open(n)}}]),accountAppControllers.controller("ModifyQuestionCtrl",["$scope","$rootScope","$http","$location","Request","$timeout","Config","Validate","Loading","questionData",function(e,t,o,n,i,a,r,c,s,l){t.dialogTitle="设置安全问题",e.questionsOne=[],e.questionsTwo=[],e.questionsThree=[];var u=n.search();if(e.invalid={},e.question={},e.question.question1={k:"",v:"请选择"},e.question.question2={k:"",v:"请选择"},e.question.question3={k:"",v:"请选择"},e.util.submitted=!1,!t.currentToken)if(u&&u.code){t.currentUid=u.uid||"";var d={"for":"UPDATE_SECQUES",uid:u.uid,email_code:u.code};i.checkUpdateCaptcha(d).then(function(e){"0"==e.errno?t.currentToken=e.data:n.path("/auth/modifyQuestion")},function(e){})}else n.path("/auth/modifyQuestion");var p=[],f=function(){if("0"==l.errno){var t=[],o=[];angular.forEach(l.data,function(e,n){t.push(n),o.push(e)}),p.push({k:"",v:"请选择"});for(var n=0;n<t.length;n++)p.push({k:t[n],v:o[n]});e.updateQuestion()}};e.updateQuestion=function(){e.questionsOne=[],e.questionsTwo=[],e.questionsThree=[],e.question.question1||(e.question.question1={k:"",v:"请选择"}),e.question.question2||(e.question.question2={k:"",v:"请选择"}),e.question.question3||(e.question.question3={k:"",v:"请选择"}),angular.forEach(p,function(t){switch(t.k){case"":e.questionsOne.push(t),e.questionsTwo.push(t),e.questionsThree.push(t);break;case e.question.question1.k:e.questionsOne.push(t);break;case e.question.question2.k:e.questionsTwo.push(t);break;case e.question.question3.k:e.questionsThree.push(t);break;default:e.questionsOne.push(t),e.questionsTwo.push(t),e.questionsThree.push(t)}}),e.question1Required=""==e.question.question1.k,e.question2Required=""==e.question.question2.k,e.question3Required=""==e.question.question3.k,a(function(){e.form.question1.$setValidity("question1",!e.question1Required),e.form.question2.$setValidity("question1",!e.question2Required),e.form.question3.$setValidity("question1",!e.question3Required)})},f(),e.next=function(){if(e.util.submitted=!0,""==e.question.question1.k&&(e.question1Required=!0),""==e.question.question2.k&&(e.question2Required=!0),""==e.question.question3.k&&(e.question3Required=!0),!(e.question1Required||e.question2Required||e.question3Required))if(e.form.$valid){var o={uid:t.currentUid,"ext[token]":t.currentToken};o["user[secques]["+e.question.question1.k+"]"]=e.question.answer1,o["user[secques]["+e.question.question2.k+"]"]=e.question.answer2,o["user[secques]["+e.question.question3.k+"]"]=e.question.answer3,s.start(),i.updateUserQuestion(o).then(function(e){s.done(),"0"==e.errno&&n.path("/result/modifyQuestion")},function(e){s.done()})}else{if(e.errAnimation={},e.form.answer1.$invalid)return void(e.errAnimation.answer1=!0);if(e.form.answer2.$invalid)return void(e.errAnimation.answer2=!0);if(e.form.answer3.$invalid)return void(e.errAnimation.answer3=!0)}}}]),accountAppControllers.controller("ForgotPasswordCtrl",["$scope","$rootScope","$http","$location","$route","Request","Config","User","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l){function u(){t.showCcc&&(e.cccList=r.cccList,e.ccc=r.defaultCountryCode,e.country=r.defaultCountryName)}t.dialogTitle="忘记密码",e.invalid={},e.util.submitted=!1,e.focus={},u(),e.switchModel=function(){t.showCcc=!t.showCcc,u()};var d=!1;e.showList=function(e){d||($(".country-list").show(),e.stopPropagation(),d=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),d=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.invalid.username=!0,e.invalid.nameValid=!0,e.util.submitted=!1},e.next=function(){if(e.util.submitted=!0,e.form.$valid){l.start();var o={};o.username=e.user.username,e.user.captcha&&(o.captcha=e.user.captcha),e.showCcc&&(o.username="+"+e.ccc+" "+o.username),a.getNoLoginAuths(o).then(function(o){switch(l.done(),+o.errno){case 0:n.path("/auth/forgotPassword"),t.forgotPasswordMsg=o;break;case r.errnoMap.PARAMETER_ERROR:case r.errnoMap.INVALID_CELLPHONE:case r.errnoMap.ILLEGAL_CELLPHONE:case r.errnoMap.INVALID_UID:case r.errnoMap.ILLEGAL_EMAIL:case r.errnoMap.INVALID_EMAIL:case r.errnoMap.UNREGISTERED_NICKNAME:e.reloadCaptcha(),e.invalid.nameValid=!1,e.focus.username=!0;break;case r.errnoMap.ILLEGAL_VCODE:case r.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case r.errnoMap.REFRECH_VCODE:e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0}},function(e){l.done()})}else if(e.errAnimation={},e.form.username.$invalid)return void(e.errAnimation.username=!0)},e.reloadCaptcha=function(){e.captchaUrl=c.refreshCaptcha();var t=$(".tips-verifycon");t.addClass("active"),setTimeout(function(){t.removeClass("active")},600)},e.reloadCaptcha()}]),accountAppControllers.controller("SettingsCtrl",["$scope","$rootScope","$http","$location","$window","Request","Config","UtilTools","Loading","settings",function(e,t,o,n,i,a,r,c,s,l){t.dialogTitle="账户设置",e.originUrl=t.targetOrigin?"?return_url="+t.targetOrigin:"";var u=/embed/.test(n.$$path);if(u&&i.parent==i)return void n.url("/result/illegality");var d=n.$$protocol+"://"+n.$$host+"/#"+n.$$path;"0"==l.errno?(e.settings=l.data,e.settings.email||1!=e.settings.active?e.settings.email&&1==e.settings.active?e.emailStatus=1:3==e.settings.active&&(e.emailStatus=2):e.emailStatus=0,e.cellphoneActive=e.settings.active,e.secquesActive=!!e.settings.secques,e.isEmailSend=!1,e.sendEmail=function(){e.isEmailSend=!0,s.start(),a.sendNewEmail({email:e.settings.email,uid:e.settings.uid}).then(function(e){s.done()},function(e){s.done()})},e.gotoEmail=function(){var t=e.settings.email,o=t.split("@")[1],n=r.mailUrl[o]||"http://mail."+o+"/";window.open(n)}):(n.search().return_url=d,u?n.path("/login/embed"):n.path("/login"))}]),accountAppControllers.controller("ResultCtrl",["$scope","$rootScope","$http","$location","$routeParams","$sce","$interval","$window","Request","Config","GTMAnalyticsService",function(e,t,o,n,i,a,r,c,s,l,u){function d(o){o&&o.code?s.updateUserEmail({uid:o.uid,"user[email]":o.email,"ext[email_code]":o.code}).then(function(o){"0"==o.errno?(m="修改邮箱成功",h="您的邮箱已经修改成功",t.title="修改邮箱成功"):(m="修改邮箱失败",h="您的邮箱修改失败",t.title="修改邮箱失败",e.fail=!0),t.dialogTitle=m,e.resultInfo=a.trustAsHtml(h)},function(e){n.path("/result/error")}):n.path("/")}function p(o){o&&o.code?s.activeUserEmail({uid:o.uid,active:"email",email_code:o.code}).then(function(o){"0"==o.errno?(m="激活邮箱成功",h="您的邮箱已经激活成功",t.title="激活邮箱成功"):(m="激活邮箱失败",h="您的邮箱激活失败",t.title="激活邮箱失败",e.fail=!0),t.dialogTitle=m,e.resultInfo=a.trustAsHtml(h)},function(e){n.path("/result/error")}):n.path("/")}e.timerToUrl=null;var f=function(){var t=3,o=!1;e.timerToUrl=t;for(var n in window.dataLayer)window.dataLayer[n].event&&"gtm-register-success"==window.dataLayer[n].event&&(o=!0);o||u.registerSuccess(),r(function(){e.timerToUrl--},1e3,t).then(function(){c.location.href=e.getGotoUrl()})};f();var m="",h="",g="返回",v="";switch(i.channelID){case"register":m="注册成功",h="您已经注册成功<br>请妥善保存您的账号和密码",t.title="注册成功";break;case"bindAccount":m="提示",h="手机号已绑定成功",v="当您下次访问锤子科技官网时，可使用该号码直接登录",t.title="手机号已绑定成功";break;case"login":m="登录成功",h="您已经登录成功",t.title="登录成功";break;case"modifyName":m="昵称修改成功",h="您的昵称已经修改成功",t.title="昵称修改成功";break;case"modifyPassword":m="密码重置成功",h="您的密码已经重置成功",t.title="密码重置成功";break;case"modifyMobile":m="修改手机成功",h="您的手机已经修改成功",t.title="修改手机成功";break;case"modifyMail":var b=n.search();d(b);break;case"modifyQuestion":m="提示",h="您的密码保护问题修改成功",t.title="修改密保成功";break;case"modifyAvatar":m="修改头像成功",h="您的头像已经修改成功",t.title="修改头像成功";break;case"activateMail":var b=n.search();p(b);break;case"illegality":m="提示",h="没有操作权限",t.title="没有权限",e.fail=!0;break;case"bound":m="提示",h="该第三方账号已绑定其他欢喜云账号",t.title="该第三方账号已绑定其他欢喜云账号",e.fail=!0;break;case"error":m="提示",h="操作失败",t.title="操作失败",e.fail=!0;break;case"system":m="系统错误",h="系统错误，请稍候重试",t.title="系统错误",e.fail=!0;break;case"unauthorized":m="提示",h="您需要登录才能进行刚才的操作",t.title="没有权限",e.fail=!0;break;default:n.path("/")}e.getGotoUrl=function(){var e=n.search();console.log("$location",n),console.log("$location",n.search());var t=l.officialURL,o=decodeURIComponent(e.return_url);return e.referer&&"cloud"==e.referer&&(t=l.cloudURL),l.regExp.isSafeUrl.test(o)&&(t=o),g=/cloud.smartisan.com/i.test(o)?"返回欢喜云":/bbs.smartisan.com/i.test(o)?"返回锤子科技官方论坛":/(smartisan.com\/shop)|(store.smartisan.com)/i.test(o)?"返回在线商城":/dev.smartisan.com/i.test(o)?"返回 Smartisan 开发者中心":"返回",t},e.gotoUrl=e.getGotoUrl(),t.dialogTitle=m,e.resultInfo=a.trustAsHtml(h),e.resultTip=v,e.returnInfo=g}]),accountAppControllers.controller("LoginGuestCtrl",["$scope","$rootScope","$http","$location","$window","$timeout","User","Request","$routeParams","Config","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l,u,d){t.dialogTitle="登录账户",e.invalid={},e.focus={},e.util.submitted=!1;var p=/embed/.test(n.$$url);if(p&&i.parent==i)return void n.url("/result/illegality");var f=n.search().return_url;n.search().username;e.login=function(){if(e.util.submitted=!0,e.form.$invalid)return void u.checkErrNumber(e,e.form);var o=e.user;d.start(),c.login(o).then(function(o){switch(d.done(),o.errno){case l.errnoMap.ILLEGAL_PASSWORD:case l.errnoMap.INVALID_PASSWORD:e.invalid.passwordValid=!1,e.focus.password=!0;break;case l.errnoMap.INVALID_CELLPHONE:case l.errnoMap.INVALID_UID:case l.errnoMap.INVALID_EMAIL:e.invalid.nameValid=!1;break;case l.errnoMap.ILLEGAL_VCODE:case l.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case l.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,e.loginCaptchaUrl=o.data.captcha,a(function(){e.focus.captcha=!0},500);break;case l.errnoMap.REFRECH_VCODE:e.captchaNeeded=!0,e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case l.errnoMap.FAILED_LOGIN_LIMIT:e.invalid.passwordValid=!1,e.focus.password=!0,e.captchaNeeded=!0,e.loginCaptchaUrl=o.data.captcha;break;case l.errnoMap.OK:if(p)i.parent!==i&&i.parent.postMessage("isLoggedIn",t.targetOrigin);else{if(l.regExp.isSafeUrl.test(decodeURIComponent(f))){if(f.indexOf(l.baseHost)>=0){var r=f.split("#");r[1]&&n.path(r[1])}else i.location.replace(f);return}var c=s.action;switch(c){case"modifyPassword":n.path("/"+c);break;case"modifyMobile":case"modifyMail":case"modifyQuestion":n.path("/auth/"+c);break;default:n.path("/result/login")}}}},function(e){d.done()})},e.toRegister=function(){p?n.path("/register/embed"):n.path("/register")},e.toGuestRegister=function(){p?n.path("/register-guest/embed"):n.path("/register-guest")},e.forgotPassword=function(){p?i.open(l.baseProtocolHost+"/#/forgotPassword"):n.path("/forgotPassword")},e.reloadCaptcha=function(){var t=e.loginCaptchaUrl;t=t.lastIndexOf("?")>0?t+"&"+ +new Date:t+"?"+ +new Date,e.loginCaptchaUrl=t}}]),accountAppControllers.controller("RegisterGuestCtrl",["$scope","$rootScope","$window","$http","$location","$timeout","$interval","Request","Config","User","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l,u,d){t.dialogTitle="验证手机",e.invalid={},e.focus={},e.showBtn=!0,e.user={},e.util.submitted=!1;var p=/embed/.test(i.$$path);if(p&&o.parent==o)return void i.url("/result/illegality");e.register=function(){return e.util.submitted=!0,e.form.$invalid?void u.checkErrNumber(e,e.form):(d.start(),e.clicked=!0,void c.register({"user[cellphone]":e.user.mobile,"ext[cellphone_code]":e.user.verification}).then(function(n){switch(d.done(),e.clicked=!1,+n.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1;break;case s.errnoMap.REFRECH_VCODE:e.invalid.captchaReload=!1;break;case s.errnoMap.OK:p?o.parent!==o&&o.parent.postMessage("isRegistered",t.targetOrigin):i.path("/result/register")}},function(t){d.done(),e.clicked=!1}))};var f=function(){var t=60;e.timer=t,e.showBtn=!1,r(function(){e.timer--},1e3,t).then(function(){e.showBtn=!0})};e.resend=function(){if(!e.form.mobile.$invalid&&!e.form.captcha.$invalid){var t={cellphone:e.user.mobile,captcha:e.user.captcha};e.captchaSubmitted=!0,c.sendMobileCaptcha(t).then(function(t){if(e.captchaSubmitted=!1,0!=t.errno)switch(+t.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.ILLEGAL_VCODE:case s.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1;break;case s.errnoMap.CAPTCHA_REQUIRED:e.reloadCaptcha(),e.focus.captcha=!0;break;case s.errnoMap.REFRECH_VCODE:e.invalid.captchaValid=!1,e.reloadCaptcha(),e.focus.captcha=!0;break;case s.errnoMap.VCODE_TOO_OFTEN:f()}else f()},function(e){})}},e.reloadCaptcha=function(){e.loginCaptchaUrl=l.refreshCaptcha();var t=$(".tips-verifycon");t.addClass("active"),setTimeout(function(){t.removeClass("active")},600)},e.reloadCaptcha(),e.validateMobile=function(){e.form.mobile.$invalid||c.checkMobile({m:"get",cellphone:e.user.mobile,action:"check"}).then(function(t){if(0!=t.errno)switch(t.errno){case s.errnoMap.REGISTERED_CELLPHONE:e.invalid.mobileRegistered=!1;break;case s.errnoMap.ILLEGAL_CELLPHONE:e.invalid.mobile=!1}},function(e){})},e.validateMobileCaptcha=function(){if(!e.form.verification.$invalid)return e.form.mobile.$invalid?void(e.invalid.mobileCaptchaValid=!1):void c.checkMobileCaptcha({action:"renew",cellphone:e.user.mobile,cellphone_code:e.user.verification}).then(function(t){if(0!=t.errno)switch(t.errno){case s.errnoMap.INVALID_VCODE:case s.errnoMap.ILLEGAL_VCODE:e.invalid.mobileCaptchaValid=!1;break;case s.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1}},function(e){})},e.toLogin=function(){p?i.path("/login/embed"):i.path("/login")}}]),accountAppControllers.controller("ModifyAvatarCtrl",["$scope","$rootScope","$http","$q","$location","$window","$timeout","User","Request","$routeParams","Config","Validate","Loading",function(e,t,o,n,i,a,r,c,s,l,u,d,p){t.dialogTitle="设置头像";var f=/embed/.test(i.$$url),m=(i.search().return_url,i.search().username),h=!1;if(f&&a.parent==a)return void i.url("/result/illegality");var g,v,b,w=/\.(jpg|jpeg|png)$/i,C=2097152,E=500,y=500,A=340,k=270,L=[(A-k)/2,0,k,k],R={w:0,h:0},M={x:0,y:0,w:0,h:0},I=50,V=".jcrop-holder",_=(a.URL||(a.URL=a.webkitURL))&&a.URL.createObjectURL,D=!!_,O=$("#aim"),U=$("#avatar"),T=$(".info"),q=function(t){e.remindInfo=t,T.animate({bottom:"61px",opacity:1},{duration:500,queue:!1,easing:"easeOutQuart",complete:function(){T.css({zIndex:100}),e.closeInfo(3e3)}})};e.closeInfo=function(e){b&&r.cancel(b),b=r(function(){T.css({zIndex:-100}),T.animate({bottom:"25px",opacity:0},{duration:500,queue:!1,easing:"easeOutQuart",complete:function(){}})},e)};var S=function(e,t){var o,n,i,a,r=e.width(),c=e.height();t=t||r/c,t>A/k?(o=A,n=o/t,n<I&&(n=I,o=n*t)):(n=k,o=n*t,o<I&&(o=I,n=o/t)),i=(k-n)/2,a=(A-o)/2,e.css({width:o,height:n,marginTop:i,marginLeft:a}),L[2]=L[3]=Math.min(o,n),L[0]=Math.max(0,(o-L[2])/2),L[1]=Math.max(0,(n-L[2])/2)},N=function(){var e=O.attr("src"),t=U.attr("src");return function(){v&&v.destroy(),U.attr("src",t),O.attr("src",e),U.css({backgroundColor:"transparent"}),O.css({backgroundColor:"transparent"})}}(),P=function(){var e,t,o,n,i=O.parent(),a=function(a){if(parseInt(a.w)>0){o=i.width(),n=i.height();var r=o/a.w,c=n/a.h;O.css({width:Math.round(r*e)+"px",height:Math.round(c*t)+"px",marginLeft:"-"+Math.round(r*a.x)+"px",marginTop:"-"+Math.round(c*a.y)+"px"}),M.x=a.x/e*R.w,M.y=a.y/t*R.h,M.w=a.w/e*R.w,M.h=a.h/t*R.h;var s=+$(V).css("margin-left").slice(0,-2);s+a.x<0?$(V).css("margin-left",-a.x):s+a.x>A-a.w&&$(V).css("margin-left",A-a.w-a.x);var l=+$(V).css("margin-top").slice(0,-2);l+a.y<0?$(V).css("margin-top",-a.y):l+a.y>k-a.h&&$(V).css("margin-top",k-a.h-a.y)}else M.w=0};return function(){v&&v.destroy(),U.Jcrop({onChange:a,onSelect:a,minSize:[I,I],allowSelect:!0,aspectRatio:o/n||1,setSelect:L},function(){var o=this.getBounds();e=o[0],t=o[1],$(V).find("img").css({backgroundColor:"#fff"}),$("#editAreaMask")[0]&&$("#editAreaMask").css({position:"absolute",filter:"alpha(opacity=40)",top:0,right:0,bottom:0,left:0,backgroundColor:"#000"}).appendTo(V),$(V).css({marginTop:U.css("marginTop"),marginLeft:U.css("marginLeft")}),a({x:L[0],y:L[1],w:L[2],h:L[3]}),v=this,h=!0})}}();$("#upload").on("change",function(e){h=!1;var t=this,o=(U[0],O[0],t.files&&t.files[0]?t.files[0].name:t.value),i=t.files&&t.files[0]?t.files[0].size:0;if(!o||!w.test(o))return r(function(){q("文件格式错误，请重新选择")},0),t.value="",void N();if(i>C)return r(function(){q("文件过大，请重新选择")},0),t.value="",void N();U.css({width:"auto",height:"auto",display:"none"});var a=n.defer();D?a.resolve(_(t.files[0])):(p.start(),s.uploadImageForAvatar("upload").then(function(e){switch(p.done(),+e.errno){case u.errnoMap.OK:a.resolve(e.data.avatar_url+"?"+ +new Date);break;case u.errnoMap.ILLEGAL_AVATAR:q("文件格式错误，请重新选择")}},function(e){q("文件过大或格式错误，请重新选择"),N(),p.done()})),a.promise.then(function(e){U.attr("src",e),O.attr("src",e),U.load(function(){R.w=U.width(),R.h=U.height(),g=R.w/R.h,S(U,g),U.unbind("load"),U.css({display:"block",backgroundColor:"#fff"}),O.css({backgroundColor:"#fff"}),P()})})});var x=function(){var e=n.defer(),t=new Image;return t.onload=function(){var o=document.createElement("canvas");M.w=M.h=Math.min(Math.round(M.w),Math.round(M.h)),o.width=Math.min(M.w,E),o.height=Math.min(M.h,y);var n=o.getContext("2d");n.drawImage(t,M.x,M.y,M.w,M.h,0,0,o.width,o.height);var i=o.toDataURL("image/png");i=i.replace(/^data\:image\/png\;base64\,/,""),e.resolve(i)},M.w?t.src=_($("#upload")[0].files[0]):(q("未选择图片区域"),e.reject()),e.promise},H=function(o){s.updataUserAvatar(o).then(function(o){switch(p.done(),+o.errno){case u.errnoMap.OK:f?a.parent!==a&&a.parent.postMessage("isModifiedAvatar",t.targetOrigin):e.isSamePage?e.$parent[e.okCallback](o.data):i.path("/result/modifyAvatar");break;default:q("上传失败"),N()}},function(e){p.done()})};e.confirm=function(){if(!h)return q("请点击【重新选择】选择图片文件"),void N();p.start();var e={},o=n.defer();t.currentUid&&(e.uid=t.currentUid),m&&(e.username=m),e.cropped=D,D?x().then(function(t){e.imgData=t,o.resolve()},function(){p.done()}):(e.coordData=M,o.resolve()),o.promise.then(function(){H(e)})},e.cancel=function(){f?a.parent!==a&&a.parent.postMessage("dialogClose",t.targetOrigin):e.isSamePage?e.$parent[e.cancelCallback]():a.history.length>1&&a.history.back(1)}}]),accountAppControllers.controller("ModifyNameCtrl",["$scope","$rootScope","$http","$location","Request","Config","Loading","Validate",function(e,t,o,n,i,a,r,c){t.dialogTitle="设置昵称",e.invalid={},e.user={},e.util.submitted=!1;var s=n.search();e.modify=function(){if(e.util.submitted=!0,!e.form.$valid)return void c.checkErrNumber(e,e.form);r.start();var o={"user[nickname]":e.user.nickname};t.currentUid&&(o.uid=t.currentUid),s.username&&(o.username=s.username),i.updateUserNickname(o).then(function(t){switch(r.done(),+t.errno){case a.errnoMap.OK:n.path("/result/modifyName");break;case a.errnoMap.INVALID_NICKNAME:e.invalid.nickname=!1;break;case a.errnoMap.REGISTERED_NICKNAME:e.invalid.nicknameRegistered=!1;break;case a.errnoMap.ILLEGAL_NICKNAME:e.invalid.nicknameIllegal=!1}},function(e){r.done()})}}]),accountAppControllers.controller("BindAccountCtrl",["$scope","$rootScope","$window","$http","$location","$timeout","$interval","Request","Config","User","Validate","Loading","bindUserInfo","Utils",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f){t.dialogTitle="绑定手机",p.errno==s.errnoMap.OK&&p.data.nickname&&""!=p.data.nickname||i.path("/result/illegality").replace(),e.platformName="微信",/qq/i.test(p.data.type)?e.platformName=" QQ ":/weibo/i.test(p.data.type)&&(e.platformName="微博"),e.invalid={},e.focus={},e.showBtn=!0,e.user={},e.util.submitted=!1;var m=i.search().return_url;m||(m=s.officialURL),e.cccList=s.cccList,e.ccc=s.defaultCountryCode,e.country=s.defaultCountryName;var h=!1;e.showList=function(e){h||($(".country-list").show(),e.stopPropagation(),h=!0,$(".wrapper").one("click",function(){$(".country-list").hide(),h=!1}))},e.changeCountry=function(t,o){e.ccc=t.slice(1)||e.ccc,e.country=o||e.country,e.form.mobile.$setValidity("mobile",!0),e.form.mobile.$setValidity("mobileRegistered",!0),e.validateMobile()},e.submitInfo=function(){if(e.util.submitted=!0,e.form.$invalid){if(e.errAnimation={},e.form.mobile.$invalid)return void(e.errAnimation.mobile=!0);if(e.form.captcha.$invalid)return;return void e.form.verification.$invalid}d.start(),e.clicked=!0,c.bindMobile({"user[cellphone]":"+"+e.ccc+" "+e.user.mobile,"ext[cellphone_code]":e.user.verification}).then(function(t){switch(d.done(),e.clicked=!1,+t.errno){case s.errnoMap.INVALID_VCODE:e.invalid.mobileCaptchaValid=!1;break;case s.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1;break;case s.errnoMap.OPENID_OTHER_REGISTERED:e.form.mobile.$setValidity("mobileOtherRegistered",!1);break;case s.errnoMap.OPENID_REGISTERED:e.form.mobile.$setValidity("openidOtherRegistered",!1);break;case s.errnoMap.OK:i.path("/result/bindAccount").search({return_url:f.unicode(m)}).replace();break;case s.errnoMap.CELLPHONE_NO_REGISTER:i.path("/bindPassword").search({return_url:f.unicode(m)}).replace();break;case s.errnoMap.NO_AUTH:i.path("/result/illegality").replace()}},function(t){d.done(),e.clicked=!1})};var g=function(){var t=60;e.timer=t,e.showBtn=!1,r(function(){e.timer--},1e3,t).then(function(){e.showBtn=!0})};e.resend=function(){if(e.captchaSubmitted=!0,e.form.mobile.$invalid)return e.errAnimation={},void(e.errAnimation.mobile=!0);if(!e.form.captcha.$invalid){var t={cellphone:"+"+e.ccc+" "+e.user.mobile,captcha:e.user.captcha};e.captchaSubmitted=!0,c.sendBindMobileCaptcha(t).then(function(t){if(e.captchaSubmitted=!1,0!=t.errno)switch(+t.errno){case s.errnoMap.REGISTERED_CELLPHONE:break;case s.errnoMap.ILLEGAL_CELLPHONE:e.invalid.mobile=!1;break;case s.errnoMap.ILLEGAL_VCODE:e.invalid.captchaValid=!1;break;case s.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1;break;case s.errnoMap.CAPTCHA_REQUIRED:e.reloadCaptcha(),e.focus.captcha=!0;break;case s.errnoMap.REFRECH_VCODE:e.invalid.captchaValid=!1,e.reloadCaptcha(),e.focus.captcha=!0;break;case s.errnoMap.VCODE_TOO_OFTEN:g()}else g()},function(e){})}},e.reloadCaptcha=function(){e.loginCaptchaUrl=l.refreshCaptcha();var t=$(".tips-verifycon");t.addClass("active"),setTimeout(function(){t.removeClass("active")},600)},e.reloadCaptcha(),e.validateMobile=function(){if(e.form.mobile.$setValidity("mobileOtherRegistered",!0),e.form.mobile.$setValidity("openidOtherRegistered",!0),"86"==e.ccc){if(!s.regExp.isCnMobile.test(e.user.mobile))return void e.form.mobile.$setValidity("mobile",!1)}else if(!s.regExp.isMobile.test(e.user.mobile))return void e.form.mobile.$setValidity("mobile",!1)},e.validateMobileCaptcha=function(){if(!e.form.verification.$invalid)return e.form.mobile.$invalid?void(e.invalid.mobileCaptchaValid=!1):void c.checkMobileCaptcha({action:"renew",cellphone:"+"+e.ccc+" "+e.user.mobile,cellphone_code:e.user.verification}).then(function(t){if(0!=t.errno)switch(t.errno){case s.errnoMap.INVALID_VCODE:case s.errnoMap.ILLEGAL_VCODE:e.invalid.mobileCaptchaValid=!1;break;case s.errnoMap.REFRECH_VCODE:e.invalid.mobileCaptchaReload=!1}},function(e){})}}]),accountAppControllers.controller("BindPasswordCtrl",["$scope","$rootScope","$window","$http","$location","$timeout","$interval","Request","Config","User","Validate","Loading","bindUserInfo","Utils","GTMAnalyticsService",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f,m){t.dialogTitle="设置手机号登录密码",p.errno==s.errnoMap.OK&&p.data.nickname&&""!=p.data.nickname||i.path("/result/illegality").replace(),e.platformName="微信",/qq/i.test(p.data.type)?e.platformName=" QQ ":/weibo/i.test(p.data.type)&&(e.platformName="微博"),e.invalid={},e.focus={},e.showBtn=!0,e.user={},e.passCheck=function(){e.form.password.$setValidity("serverError",!0),e.form.password.$setValidity("mobileOtherRegistered",!0),e.form.password.$setValidity("openidOtherRegistered",!0)},e.util.submitted=!1;var h=i.search().return_url;h||(h=s.officialURL),e.submitInfo=function(){if(e.util.submitted=!0,e.form.$invalid){if(e.errAnimation={},e.form.password.$invalid)return void(e.errAnimation.password=!0);if(e.form.repassword.$invalid)return void(e.errAnimation.repassword=!0)}else d.start(),e.clicked=!0,c.bindPassword({"user[password]":e.user.password}).then(function(t){switch(d.done(),e.clicked=!1,+t.errno){case s.errnoMap.OK:m.registerSuccess(),i.path("/result/bindAccount").search({return_url:f.unicode(h)}).replace();break;case s.errnoMap.OPENID_OTHER_REGISTERED:e.form.password.$setValidity("mobileOtherRegistered",!1);break;case s.errnoMap.OPENID_REGISTERED:e.form.password.$setValidity("openidOtherRegistered",!1);break;default:e.form.password.$setValidity("serverError",!1)}},function(t){d.done(),e.clicked=!1})}}]),accountAppControllers.controller("SafetyCtrl",["$rootScope","$scope","$location","$window","Config",function(e,t,o,n,i){e.dialogTitle="账户安全提醒";var a=o.search().return_url;t.backToPrevious=function(){if(i.regExp.isSafeUrl.test(decodeURIComponent(a)))if(a.indexOf(i.baseHost)>=0){var e=a.split("#");e[1]&&o.path(e[1])}else n.location.replace(decodeURIComponent(a))},t.goToModifyPassword=function(){o.path("/modifyPassword").search({return_url:decodeURIComponent(a)})}}]),accountAppControllers.controller("PersonalAccountCtrl",["$scope","$rootScope","$timeout","$animate","Config","Request","Dialog","Filter","userInfo","$location",function(e,t,o,n,i,a,r,c,s,l){n.enabled(!1),e.currentSideBar="account",e.returnURL=encodeURIComponent("https://yun.smartisan.com/#/personal/account"),e.user=s[0].data,e.newAvatarUrl=e.user.avatarUrl,e.sendEmailText="发送邮件",e.authorizationlist=["使用您的昵称和头像"],e.thirdPartyAppList=[],e.authAppList=[],s[1]&&(e.thirdPartyAppList=s[1].data),s[2]&&(e.authAppList=s[2].content);var u,d,p=!1;e.openModifyAvatar=function(){r.open({headline:"设置头像",size:"modify-avatar-size",id:"partModifyAvatar"},e)},e.callBackCancel=function(){r.close()},e.callBackOk=function(t){e.newAvatarUrl=t.avatar_url+"?"+(new Date).getTime(),e.callBackCancel()},e.sendEmail=function(){p?window.open(c.emailLocation(e.user.email)):(p=!0,e.sendEmailText="查看邮件",a.sendAccountEmail({active:"email"}).then(function(e){e.errno===i.errnoMap.VCODE_TOO_OFTEN&&r.toast({msg:"操作太过频繁, 请稍后重试"})},function(e){}))},e.bindThirdParty=function(t){a[t+"Login"](e.returnURL)},e.unbindThirdParty=function(t){d=t,r.open({headline:"提示",id:"unbindThirdPartyApp",size:"unbind-third-party"},e)},e.doUnbindTP=function(){a.unbindThirdPartyApp(d).then(function(t){if(1==t.data&&0==t.errno){r.bubble({status:"success",msg:"账号解绑成功",close:"true",time:1500});for(var o=0;o<e.thirdPartyAppList.length;o++)e.thirdPartyAppList[o].platform==d&&(e.thirdPartyAppList[o].bind=0)}t.errno===i.errnoMap.VCODE_TOO_OFTEN&&r.toast({msg:"操作太过频繁, 请稍后重试"})},function(e){})},e.revokeAuth=function(t){u=t,r.open({headline:"提示",size:"revoke-auth-size",id:"revokeAuth"},e)},e.doRevokeAuth=function(){a.revokeAuthorization(u).then(function(t){if($.isEmptyObject(t)){r.bubble({status:"success",msg:"取消授权成功",close:!0,time:1500});for(var o=0;o<e.authAppList.length;o++)e.authAppList[o].grant_id==u&&e.authAppList.splice(o,1)}t.errno===i.errnoMap.VCODE_TOO_OFTEN&&r.toast({msg:"操作太过频繁, 请稍后重试"})},function(e){})}}]),accountAppControllers.controller("PersonalDeviceCtrl",["$scope","$rootScope","$http","$location","$timeout","$animate","Config","Loading","Request","Content","Filter","Dialog","userInfo","deviceData",function(e,t,o,n,i,a,r,c,s,l,u,d,p,f){function m(t){var o={id:w.id,password:e.model.password};t&&(o=$.extend({force:1},o)),s.deleteDevice(o).then(function(e){e.errno||t?e.data&&!e.errno&&t?d.bubble({status:"success",msg:"您的设备已解绑成功。",reload:!0,time:3500}):d.bubble({status:"error",msg:"因连接服务器失败，导致解绑操作无法继续进行，请稍后重试",reload:!0,time:3500}):h()},function(e){})}function h(){d.bubble({status:"loading",msg:"正在解绑中..."}),g()}function g(){L=i(function(){A+=3e3,console.log("deleting:",A),A>=k?(i.cancel(L),d.bubble({status:"error",msg:"因连接服务器失败，导致解绑操作无法继续进行，请稍后重试",replace:!0,reload:!0,time:3500})):g()},3e3),s.getSingleDeviceInfo({id:w.id}).then(function(e){e.errno===r.errnoMap.SUCCESS_FOR_DELETE_DEVICE?(i.cancel(L),d.bubble({status:"success",msg:"您的设备已解绑成功，该设备将放入已解绑设备列表，且不可进行任何操作",replace:!0,reload:!0,time:3500})):e.errno===r.errnoMap.INVALID_DEVICE_ID&&(i.cancel(L),d.bubble({status:"error",msg:"因连接服务器失败，导致解绑操作无法继续进行，请稍后重试",replace:!0,reload:!0,time:3500}))},function(e){console.log("err")})}function v(){y=i(function(){C+=6e4,C>=E?i.cancel(y):v()},6e4),e.curDevices=l.parseDeviceIsOnline(e.curDevices)}function b(t,o){switch(t.errno){case r.errnoMap.ILLEGAL_PASSWORD:case r.errnoMap.INVALID_PASSWORD:e.invalid.passwordValid=!1,e.focus.password=!0;break;case r.errnoMap.ILLEGAL_VCODE:case r.errnoMap.INVALID_VCODE:e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case r.errnoMap.CAPTCHA_REQUIRED:e.captchaNeeded=!0,e.loginCaptchaUrl=t.data.captcha,i(function(){e.focus.captcha=!0},500);break;case r.errnoMap.REFRECH_VCODE:e.captchaNeeded=!0,e.reloadCaptcha(),e.invalid.captchaValid=!1,e.focus.captcha=!0;break;case r.errnoMap.FAILED_LOGIN_LIMIT:e.invalid.passwordValid=!1,e.focus.password=!0,e.captchaNeeded=!0,e.reloadCaptcha(t.data.captcha);break;case r.errnoMap.OK:o&&o()}}a.enabled(!1),e.currentSideBar="device",e.devices=f.data,e.deletedDevices=u.changeToArray(f.data.unbind),e.curDevices=u.changeToArray(f.data.bind),e.isEmpty=u.checkIsEmptyObject(f.data.unbind)&&u.checkIsEmptyObject(f.data.bind),e.isDeletedEmpty=u.checkIsEmptyObject(f.data.unbind),e.isCurEmpty=u.checkIsEmptyObject(f.data.bind),e.model={password:"",captcha:""};var w="",C=6e4,E=6e5,y=null,A=3e3,k=3e4,L=null;e.openCheckCloudByUser=function(t){w=t.device,s.getSingleDeviceInfo({id:w.id}).then(function(t){console.log(w.id),t.errno===r.errnoMap.SUCCESS_FOR_DELETE_DEVICE?(i.cancel(L),d.bubble({status:"success",msg:"您的设备已经解绑成功，可到近期解绑设备列表中查看",reload:!0,time:3500})):d.open({headline:"提示",id:"partCheckCloudByUser"},e)},function(e){console.log("err")})},e.openCheckCloudIdentity=function(){d.open({headline:"密码验证",id:"partCheckCloudIdentity"},e)},e.confirmCheckCloudIdentity=function(){e.util.submitted=!0;var t={password:e.model.password};""!==e.model.captcha&&(t.captcha=e.model.captcha),s.checkCloudPassword(t).then(function(t){b(t,function(){d.open({headline:"提示",id:"partRecheckCloudByUser"},e)})},function(e){})},e.openRecheckCloudByUser=function(){d.open({headline:"提示",id:"partRecheckCloudByUser"},e)},e.confirmRecheckCloudByUser=function(){return 5==w.status?void h():void s.getDeviceIsBankbindStatus({id:w.id}).then(function(t){return t.data?void s.getDeviceIsOnlineStatus({id:w.id}).then(function(t){t.data&&!t.errno?e.confirmDeleteDevice():d.open({headline:"提示",id:"partDeleteDeviceWithCard"},e)},function(e){}):void e.confirmDeleteDevice()},function(e){})},e.confirmDeleteDeviceWithCard=function(){var t=setTimeout(function(){d.bubble({status:"loading",msg:"正在发送命令..."})},500);s.deleteDevice({id:w.id,password:e.model.password,force:1}).then(function(o){clearTimeout(t),o.errno?d.bubble({status:"error",msg:"因连接服务器失败，导致解绑操作无法继续进行，请稍后重试",reload:!0,time:3500}):d.open({headline:"提示",id:"partConfirmDeviceWithCard"},e)},function(e){})},e.confirmDeleteDevice=function(){m(!1)},e.confirmDeleteDeviceBeForced=function(){m(!0)},e.isCurEmpty||v(),e.invalid={},e.focus={},e.util.submitted=!1,e.reloadCaptcha=function(t){var o=t||e.loginCaptchaUrl||"https://account.smartisan.com/v2/session/captcha/";o=o.lastIndexOf("?")>0?o+"&"+ +new Date:o+"?"+ +new Date,e.loginCaptchaUrl=o;var n=$(".tips-verifycon");n.addClass("active"),setTimeout(function(){n.removeClass("active")},600)}}]),accountAppDirectives.directive("iAutoFocus",["$timeout","Utils",function(e,t){return{restrict:"A",require:"ngModel",link:function(o,n,i,a){n&&(t.isMobile()||(e(function(){n.focus()},10),e(function(){location.hash.indexOf("v2/login")>=0&&n.val()&&""!=n.val()&&$(".btn-wrapper .btn").removeClass("disabled")},800)))}}}]).directive("focusOn",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){t.$watch(n.focusOn,function(t){t&&e(function(){o.focus()},10)})}}}]).directive("selectOn",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){t.$watch(n.selectOn,function(t){t&&e(function(){o.select()},10)})}}}]).directive("iFocus",[function(){var e="i-focused";return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$focused=!1,
i.$blurred=!1,o.on("focus",function(n){o.addClass(e),t.$apply(function(){i.$focused=!0})}).on("blur",function(n){o.removeClass(e),t.$apply(function(){i.$focused=!1,i.$blurred=!0})}).on("keydown",function(e){t.$apply(function(){i.$blurred=!1})})}}}]).directive("iBlur",[function(){var e="i-blurred";return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$blurred=!1,o.on("keydown",function(n){o.removeClass(e),t.$apply(function(){i.$blurred=!1})}).on("blur",function(n){o.addClass(e),t.$apply(function(){i.$blurred=!0})})}}}]).directive("iInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){t.on("focus",function(){$(this).parent(".input").addClass("focus"),jQuery.support.opacity&&$(this).parent(".input").animate({opacity:1},{queue:!1,duration:300})}),t.on("blur",function(){if($(this).parent(".input").removeClass("focus"),!$(this).val()){if($(this).prev(".placeholder").show(),!jQuery.support.opacity)return;$(this).parent(".input").animate({opacity:.618},{queue:!1,duration:300})}}),t.on("keydown input",function(t){if($(this).prev(".placeholder").hide(),13!=t.which)switch(n.$submitted=!1,e.util.submitted=!1,e.errAnimation={},angular.forEach(e.focus,function(t,o){e.focus[o]=!1}),n.$name){case"username":e.invalid.nameValid=!0,e.invalid.passwordValid=!0;break;case"password":e.invalid.passwordValid=!0;break;case"oldpassword":e.invalid.oldpasswordValid=!0;break;case"captcha":e.invalid.captchaValid=!0,e.invalid.captchaReload=!0;break;case"mobile":e.invalid.mobile=!0,e.invalid.mobileRegistered=!0;break;case"mail":e.invalid.emailRegistered=!0;break;case"nickname":e.invalid.nickname=!0,e.invalid.nicknameRegistered=!0,e.invalid.nicknameIllegal=!0;break;case"verification":e.invalid.mobileCaptchaValid=!0,e.invalid.mobileCaptchaReload=!0;break;case"answer1":case"answer2":e.invalid.answerInvalid=!0}}),e.$watch("util.submitted",function(e){e&&(n.$submitted=!0,n.$blurred=!0)})}}}).directive("iUsername",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$parsers.push(function(o){var n=t.showCcc?e.regExp.isMobile.test(o):e.regExp.isMail.test(o)||e.regExp.isCnMobile.test(o);return!o||n?(i.$setValidity(i.$name,!0),o):void i.$setValidity(i.$name,!1)})}}}]).directive("iPassword",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$parsers.push(function(t){return t=t||"",!t||e.regExp.isPassword.test(t)?(i.$setValidity("password",!0),t):void i.$setValidity("password",!1)})}}}]).directive("iPasswordFormat",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$parsers.push(function(t){return t=t||"",!t||e.regExp.isPassword.test(t)?(i.$setValidity("pwdFormat",!0),t):void i.$setValidity("pwdFormat",!1)})}}}]).directive("iRepassword",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){e.$watch(function(){return e.user&&e.user.repassword==e.user.password},function(e,t){e!=t&&(e?n.$setValidity("repassword",!0):n.$setValidity("repassword",!1))})}}}]).directive("iMobile",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$parsers.push(function(t){return!t||e.regExp.isMobile.test(t)?(i.$setValidity(i.$name,!0),t):void i.$setValidity(i.$name,!1)})}}}]).directive("iMail",["Config",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){i.$parsers.push(function(t){return!t||e.regExp.isMail.test(t)?(i.$setValidity(i.$name,!0),t):void i.$setValidity(i.$name,!1)})}}}]).directive("iResponse",["Validate",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,i){switch(i.$name){case"username":t.$watch("invalid.nameValid",function(o){o="undefined"==typeof o||o,o?i.$setValidity("nameValid",!0):(i.$setValidity("nameValid",!1),e.checkErrNumber(t,t.form))});break;case"nickname":t.$watch("invalid.nickname",function(o){o="undefined"==typeof o||o,o?i.$setValidity("nickname",!0):(i.$setValidity("nickname",!1),e.checkErrNumber(t,t.form))}),t.$watch("invalid.nicknameRegistered",function(o){o="undefined"==typeof o||o,o?i.$setValidity("nicknameRegistered",!0):(i.$setValidity("nicknameRegistered",!1),e.checkErrNumber(t,t.form))}),t.$watch("invalid.nicknameIllegal",function(o){o="undefined"==typeof o||o,o?i.$setValidity("nicknameIllegal",!0):(i.$setValidity("nicknameIllegal",!1),e.checkErrNumber(t,t.form))});break;case"password":t.$watch("invalid.passwordValid",function(o){o="undefined"==typeof o||o,o?i.$setValidity("passwordValid",!0):(i.$setValidity("passwordValid",!1),e.checkErrNumber(t,t.form))});break;case"oldpassword":t.$watch("invalid.oldpasswordValid",function(o){o="undefined"==typeof o||o,o?i.$setValidity("oldpasswordValid",!0):(i.$setValidity("oldpasswordValid",!1),e.checkErrNumber(t,t.form))});break;case"captcha":t.$watch("invalid.captchaValid",function(e){e="undefined"==typeof e||e,e?i.$setValidity("captchaValid",!0):i.$setValidity("captchaValid",!1)}),t.$watch("invalid.captchaReload",function(e){e="undefined"==typeof e||e,e?i.$setValidity("captchaReload",!0):i.$setValidity("captchaReload",!1)});break;case"mobile":t.$watch("invalid.mobileRegistered",function(o){o="undefined"==typeof o||o,o?i.$setValidity("mobileRegistered",!0):(i.$setValidity("mobileRegistered",!1),e.checkErrNumber(t,t.form))}),t.$watch("invalid.mobile",function(o){o="undefined"==typeof o||o,o?i.$setValidity("mobile",!0):(i.$setValidity("mobile",!1),e.checkErrNumber(t,t.form))});break;case"mail":t.$watch("invalid.emailRegistered",function(o){o="undefined"==typeof o||o,o?i.$setValidity("emailRegistered",!0):(i.$setValidity("emailRegistered",!1),e.checkErrNumber(t,t.form))}),t.$watch("invalid.mail",function(o){o="undefined"==typeof o||o,o?i.$setValidity("mail",!0):(i.$setValidity("mail",!1),e.checkErrNumber(t,t.form))});break;case"verification":t.$watch("invalid.mobileCaptchaValid",function(e){e="undefined"==typeof e||e,e?i.$setValidity("mobileCaptchaValid",!0):i.$setValidity("mobileCaptchaValid",!1)}),t.$watch("invalid.mobileCaptchaReload",function(e){e="undefined"==typeof e||e,e?i.$setValidity("mobileCaptchaReload",!0):i.$setValidity("mobileCaptchaReload",!1)});break;case"answer1":case"answer2":t.$watch("invalid.answerInvalid",function(o){o="undefined"==typeof o||o,o?i.$setValidity("answerInvalid",!0):(i.$setValidity("answerInvalid",!1),e.checkErrNumber(t,t.form))})}}}}]).directive("iShow",["$timeout",function(e){return{restrict:"A",link:function(e,t,o,n){e.$watch(o.iShow,function(e){e?jQuery.support.opacity?t.stop().show().animate({opacity:1},{queue:!1,duration:300}):t.stop().show():jQuery.support.opacity?t.stop().animate({opacity:0},{duration:300,done:function(){t.hide()}}):t.stop().hide()})}}}]).directive("iWarning",["$timeout","Utils",function(e,t){return{restrict:"A",link:function(o,n,i,a){var r=n.parent(".input");o.$watch(i.iWarning,function(o,i){if(!!o!=!!i&&(o?(r.addClass("invalid"),jQuery.support.opacity?n.stop().show().animate({opacity:1},{queue:!1,duration:300}):n.stop().show()):(r.removeClass("invalid"),jQuery.support.opacity?n.stop().animate({opacity:0},{duration:300,done:function(){n.hide()}}):n.stop().hide()),t.isMobile()&&$("body").attr("class").indexOf("v2")>=0)){var a=$(".warning");a.addClass("notice-m");for(var c=!1,s=null,l=0;l<=a.length;l++){var u=$(a[l]);!c&&u.css("display")&&u.css("display").indexOf("none")<0?(c=!0,s=u):c&&u.hide()}c&&e(function(){s.hide()},2500)}})}}}]).directive("slideDown",["$timeout","$location",function(e,t){return{restrict:"A",link:function(e,t,o,n){e.isMobile||e.$watch(o.slideDown,function(e){if(e){t.show();var o=t.parents(".content").outerHeight(!0),n=500,i=$(".title").outerHeight(!0),a=$(".copyright").outerHeight();$(".dialog").animate({"margin-top":-(o+i+a)/2},{duration:n,queue:!1,easing:"easeOutQuart"}),t.hide().slideDown({duration:n,easing:"easeOutQuart"})}})}}}]).directive("slideDownRegisterRepeat",["$timeout",function(e){return{restrict:"A",link:function(e,t,o,n){e.$watch(o.slideDownRegisterRepeat,function(e){if(e){if(t.css("display").indexOf("none")<0)return;t.show();var o=t.parents(".content").outerHeight(),n=500,i=$(".title").outerHeight();$(".dialog").animate({"margin-top":-(o+i)/2},{duration:n,queue:!1,easing:"easeOutQuart"}),t.hide().slideDown({duration:n,easing:"easeOutQuart"})}})}}}]).directive("iAnimation",["Utils",function(e){return{restrict:"A",link:function(e,t,o,n){e.$watch(o.iAnimation,function(o){o&&(t.stop(!0).animate({left:"-15px"},50).animate({left:"20px"},80).animate({left:"-10px"},80).animate({left:"5px"},80).animate({left:"0px"},80),e.animationTip&&(e.animationTip=!1),e.errAnimation={},e.$parent.errAnimation={})})}}}]).directive("iEnter",[function(){return function(e,t,o,n){t.bind("keydown keypress",function(t){13==t.which&&(e.$apply(function(){e.$eval(o.iEnter,{event:t})}),t.preventDefault())})}}]).directive("limitLength",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){n.$parsers.push(function(e){return e&&e.length!=+o.limitLength?void n.$setValidity("limitlength",!1):(n.$setValidity("limitlength",!0),e)})}}}]).directive("inputRadius",[function(){return{restrict:"A",link:function(e,t,o,n){t.find(":first").before('<div class="radius-left"></div><div class="radius-center"></div><div class="radius-right"></div>')}}}]).directive("btnRadius",[function(){return{restrict:"A",link:function(e,t,o,n){t.find(":first").before('<div class="radius-left"></div><div class="radius-right"></div>')}}}]).directive("copyrightYear",[function(){return{restrict:"A",link:function(e,t,o,n){var i=new Date,a=i.getFullYear(),r=i.getMonth()+1,c=2017;2016==a&&12==r&&(c=2016),$(t).html(c)}}}]).directive("iLabel",[function(){return{restrict:"A",link:function(e,t,o,n){if(!e.isMobile){var i=o.iLabel,a=i+"_mousedown";t.on("click",function(){$("#"+i).focus()}).on("mousedown",function(){e[a]=!0}).on("mouseup",function(){e[a]=!1})}}}}]).directive("iModifyAvatar",function(){return{restrict:"EA",templateUrl:"partials/modifyAvatar.html",scope:{cancelCallback:"@",okCallback:"@",isSamePage:"@"},controller:"ModifyAvatarCtrl"}}).directive("iSrc",function(){return{restrict:"A",scope:{iSrc:"@"},link:function(e,t,o){var n="img/personal/icons/avatar-default_44b3a12853.png";e.iSrc&&(n=e.iSrc),o.$set("src",n),e.$watch("iSrc",function(e,t){o.$set("src",e+"?"+(new Date).getTime())})}}}),accountAppAnimations.animation(".content",["$rootScope","$timeout","$location",function(e,t,o){return{enter:function(n,i){n=$(n);var a=/personal/.test(o.$$url);if(e.isMobile||a)return void i();var r=n.height(),c=n.outerHeight(!0),s=$(".title").outerHeight(!0),l=$(".copyright").outerHeight(),u=e.isRefresh?0:500;return n.css({height:e.height}),n.animate({height:r},{duration:u,queue:!1,easing:"easeOutQuart",complete:function(){n.css({height:"auto"}),e.height=n.height()}}),$(".dialog").animate({"margin-top":-(c+s+l)/2},{duration:u,queue:!1,easing:"easeOutQuart"}),e.isRefresh?void(e.isRefresh=!1):void(jQuery.support.opacity?(n.css({opacity:0}),t(function(){n.animate({opacity:1},300,i)},u)):(n.show(),i()))},leave:function(t,o){return t=$(t),e.isMobile?void o():(e.isFirstSwitch=!0,t.css({position:"absolute",width:"100%",boxSizing:"border-box"}),void(jQuery.support.opacity&&!e.dialogChangeFlag?t.animate({opacity:0},100,o):(t.hide(),o())))}}}]).animation(".animate-switch",["$rootScope","$timeout",function(e,t){return{enter:function(o,n){if(e.isMobile)return void n();if(!e.isFirstSwitch){o=o.parents(".content");var i=o.height(),a=o.outerHeight(),r=$(".title").outerHeight(),c=500;o.css({height:e.height}),o.animate({height:i},{duration:c,queue:!1,easing:"easeOutQuart",complete:function(){o.css({height:"auto"}),e.height=o.height()}}),$(".dialog").animate({"margin-top":-(a+r)/2},{duration:c,queue:!1,easing:"easeOutQuart"}),jQuery.support.opacity?(o.css({opacity:0}),t(function(){o.animate({opacity:1},300)},c,n)):(o.show(),n())}},leave:function(t,o){return e.isMobile?void o():(e.isFirstSwitch=!1,t.css({position:"absolute"}),void(jQuery.support.opacity?t.animate({opacity:0},100,o):(t.hide(),o())))}}}]);